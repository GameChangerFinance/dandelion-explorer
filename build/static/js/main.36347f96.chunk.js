(this["webpackJsonpdandelion-explorer"]=this["webpackJsonpdandelion-explorer"]||[]).push([[0],{187:function(e,t,a){e.exports=a(237)},193:function(e,t,a){},213:function(e){e.exports=JSON.parse('{"databases":[{"title":"Cardano Mainnet","tool":{"label":"PostgREST Help","url":"https://postgrest.org/en/v12/references/api/tables_views.html","nativeIde":"https://beta-wallet.gamechanger.finance/playground","ide":"https://inception.m2tec.nl/"},"url":"https://d.postgrest-api.mainnet.dandelion.link","publicDbAcessType":"read","foreignKeySearch":false,"primaryKeyFunction":true,"regexSupport":true},{"title":"Cardano Pre-Production Testnet","tool":{"label":"PostgREST Help","url":"https://postgrest.org/en/v12/references/api/tables_views.html","nativeIde":"https://beta-preprod-wallet.gamechanger.finance/playground","ide":"https://inception.m2tec.nl/"},"url":"https://d.postgrest-api.iohk-preprod.dandelion.link","publicDbAcessType":"read","foreignKeySearch":false,"primaryKeyFunction":true,"regexSupport":true}],"logoUrl":"https://beta-wallet.gamechanger.finance/apple-touch-icon.png","errorMsg":"ERROR"}')},234:function(e,t,a){e.exports=a.p+"static/media/progress.be1288ea.gif"},236:function(e,t,a){},237:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(11),s=a.n(r),l=a(13),o=a(14),c=a(8),u=a(17),h=a(16),d=(a(192),a(193),a(67)),m=a.n(d),p=a(104),b=a(20),g=a.n(b),f=a(42),y=function(){function e(t){Object(l.a)(this,e),this.name=null,this.isLoggedIn=!1,this.userEmail=null,this.userPassword=null,this.jwtToken=null,this.jwtTokenExpiry=null,this.dbIndex=t,this._fromLocalStorage()}return Object(o.a)(e,[{key:"getUserDetails",value:function(){var e=Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAuthenticated()){e.next=3;break}return e.next=3,this._loginPostRequest().then((function(e){return e}));case 3:return e.abrupt("return",{isLoggedIn:this.isLoggedIn,jwtToken:this.jwtToken,name:this.name||this.userEmail||"Unknown"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCredentials",value:function(e,t){this.userEmail=e,this.userPassword=t,this._toLocalStorage()}},{key:"logout",value:function(){this.userEmail=null,this.userPassword=null,this.softLogout(),this._toLocalStorage()}},{key:"softLogout",value:function(){this.name=null,this.isLoggedIn=!1,this.jwtToken=null,this.jwtTokenExpiry=null}},{key:"isAuthenticated",value:function(){if(this.jwtTokenExpiry>Date.now()&&/^(([^<>()\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.userEmail)&&this.userPassword&&""!==this.userPassword)return!0}},{key:"setDb",value:function(e){this.softLogout(),this.dbIndex=e}},{key:"_loginPostRequest",value:function(){var e=Object(p.a)(m.a.mark((function e(){var t,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.userEmail||!this.userPassword){e.next=15;break}return t=f.getDbConfig(this.dbIndex,"url")+"/rpc/login",e.prev=2,e.next=5,g.a.post(t,{email:this.userEmail,pass:this.userPassword});case 5:return a=e.sent,n=a.data[0],this._setStatusTokenExpiry(!0,n.token,n.tokenExpiry),e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(2),this._setStatusTokenExpiry(!1,null,0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"_setStatusTokenExpiry",value:function(e,t,a){this.isLoggedIn=e,this.jwtToken=t,this.jwtTokenExpiry=a>=0?a:Date.now()+36e5,this._toLocalStorage()}},{key:"_toLocalStorage",value:function(){}},{key:"_fromLocalStorage",value:function(){}},{key:"toString",value:function(){return JSON.stringify({name:this.name,isLoggedIn:this.isLoggedIn,userEmail:this.userEmail,userPassword:this.userPassword,jwtToken:this.jwtToken,jwtTokenExpiry:this.jwtTokenExpiry})}}]),e}(),v=a(19),C=a(292),k=a(291),w=a(43),E=a.n(w),S=a(297),T=a(238),O=a(286),x=a(239),L=a(295),R=a(296),F=a(290),D=a(321),B=a(323),I=a(27),j=a.n(I),P=a(83),N=a.n(P),q=a(63),M=a.n(q),_=a(95),A=a(42),V=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).changeDisplayIndexDebounce=void 0,n.timer=void 0;var i=JSON.parse(localStorage.getItem("localHistory")||"[]");return i="[]"===JSON.stringify(i)?null:i,n.state={newHistoryItem:n.props.newHistoryItem,displayIndex:-1,historyArray:i||[],deleteHistoryDialogVisibilityStyles:H.hide,snackBarVisibility:!1,snackBarMessage:"Unknown error occured"},n.changeDisplayIndexDebounce=_.debounce((function(e){return n.setState({displayIndex:e})}),300),n.closeDrawer=n.closeDrawer.bind(Object(c.a)(n)),n.showDeleteHistoryDialog=n.showDeleteHistoryDialog.bind(Object(c.a)(n)),n.deleteHistory=n.deleteHistory.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(this.state.newHistoryItem!==e.newHistoryItem&&e.newHistoryItem!==[]&&void 0!==e.newHistoryItem&&null!==e.newHistoryItem&&e.newHistoryItem)if(!1===A.inArray(e.newHistoryItem,this.state.historyArray)){var a=this.state.historyArray.slice();a.push(e.newHistoryItem),this.setState({newHistoryItem:e.newHistoryItem,historyArray:a},(function(){try{localStorage.setItem("localHistory",JSON.stringify(t.state.historyArray))}catch(e){console.error(e)}}))}else this.setState({newHistoryItem:e.newHistoryItem,historyArray:A.moveArrayElementFromTo(this.state.historyArray,A.elementPositionInArray(e.newHistoryItem,this.state.historyArray),this.state.historyArray.length-1)},(function(){try{localStorage.setItem("localHistory",JSON.stringify(t.state.historyArray))}catch(e){console.error(e)}}))}},{key:"handleHistoryItemClick",value:function(e){var t=this.state.historyArray[e][0],a=this.state.historyArray[e][1];this.props.changeTable(this.extractTableNameFromURL(t,!0)),this.props.changeRules(a)}},{key:"handleLinkIconClick",value:function(e){var t,a=this,n=!1,i=!1,r=this.state.historyArray[e][0],s=this.state.historyArray[e][1],l=/\/\w+/g.exec(r.replace(A.getDbConfig(this.props.dbIndex,"url"),""));l?t=l[0].replace(/\//g,""):(t=null,n=!0);var o="";n||(o=window.location.origin+"/queryBuilder/db/"+this.props.dbIndex+"/table/"+t,null!==s&&(o+="?query="+encodeURIComponent(JSON.stringify(s))),i=this.insertToClipboard(o)),!n&&i&&this.setState({snackBarVisibility:!0,snackBarMessage:"Link copied!"},(function(){a.timer=setTimeout((function(){a.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),2500)}))}},{key:"insertToClipboard",value:function(e){document.oncopy=function(t){t&&t.clipboardData&&(t.clipboardData.setData("Text",e),t.preventDefault())};var t=document.execCommand("Copy");return document.oncopy=null,t}},{key:"closeDrawer",value:function(){this.props.closeHistoryPane()}},{key:"extractTableNameFromURL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.replace(A.getDbConfig(this.props.dbIndex,"url"),"").replace(/\?.*/,"").replace(/\s/g,"").replace("/","");if(t)return a;var n=A.getTableConfig(this.props.dbIndex,a,"rename"),i=n||a;return i}},{key:"cleanUpRules",value:function(e){return e.replace(A.getDbConfig(this.props.dbIndex,"url"),"").replace(/.*\?/,"").replace(/&/g,"\n").replace(/,/g,",\n").replace(/limit=\d*/g,"")}},{key:"recursiveRulesExtraction",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=[];e.length>1&&(n=[[Array(a).join("\t")+t]]);for(var i=0;i<e.length;i++){var r=e[i].field;if(null!==r&&void 0!==r)n.push([Array(a+1).join("\t")+r,e[i].operator,e[i].value]);else if("AND"===e[i].condition||"OR"===e[i].condition)for(var s=this.recursiveRulesExtraction(e[i].rules,e[i].condition,a+1),l=0;l<s.length;l++)null!==s[l]&&void 0!==s[l]&&n.push(s[l])}return n}},{key:"changeDisplayIndex",value:function(e){this.changeDisplayIndexDebounce(e)}},{key:"showDeleteHistoryDialog",value:function(){null===this.state.deleteHistoryDialogVisibilityStyles?this.setState({deleteHistoryDialogVisibilityStyles:H.hide}):this.setState({deleteHistoryDialogVisibilityStyles:null})}},{key:"deleteHistory",value:function(){this.setState({historyArray:[]},(function(){try{localStorage.setItem("localHistory","[]")}catch(e){console.error(e)}})),this.showDeleteHistoryDialog()}},{key:"render",value:function(){var e=this,t=i.a.createElement("div",{style:H.list},i.a.createElement(O.a,{dense:!0,subheader:i.a.createElement(F.a,{style:H.subheaderBackgroundColour},"Query History",i.a.createElement(T.a,{onClick:this.closeDrawer,style:{float:"right"},"aria-label":"Close"},i.a.createElement(j.a,null)),i.a.createElement(T.a,{onClick:this.showDeleteHistoryDialog,style:{float:"right"},"aria-label":"Delete"},i.a.createElement(N.a,null)))},i.a.createElement("div",{style:Object(v.a)(Object(v.a)({},this.state.deleteHistoryDialogVisibilityStyles),{height:"100px",float:"right"})},i.a.createElement(F.a,null,"Delete history?"),i.a.createElement(k.a,{onClick:this.deleteHistory,variant:"contained",style:{margin:"5px"}},"Yes"),i.a.createElement(k.a,{onClick:this.showDeleteHistoryDialog,variant:"contained",style:{margin:"5px",background:E.a[500]}},"No")),i.a.createElement(C.a,null),this.state.historyArray.slice(0).reverse().map((function(t){if(t[0].indexOf(A.getDbConfig(e.props.dbIndex,"url"))>=0){var a=e.extractTableNameFromURL(t[0]);if(a.length>50&&(a=a.substring(0,50)+"..."),t[0]&&t[1]){var n=e.recursiveRulesExtraction(t[1].rules,t[1].condition,0),r=A.elementPositionInArray(t,e.state.historyArray),s=H.hide;return e.state.displayIndex===r&&(s=null),i.a.createElement(x.a,{button:!0,key:r,onMouseEnter:e.changeDisplayIndex.bind(e,r),onClick:e.handleHistoryItemClick.bind(e,r)},i.a.createElement(B.a,{id:"tooltip-bottom",title:"Copy shareable link",placement:"bottom"},i.a.createElement(L.a,{style:H.noStyleButton,onClick:e.handleLinkIconClick.bind(e,r)},i.a.createElement(M.a,null))),i.a.createElement(i.a.Fragment,null,i.a.createElement(R.a,{primary:a}),n.map((function(a){for(var l="",o="",c="",u="",h="",d=0;d<a.length;d++)l+=" "+a[d]+" ",1===d&&(o=a[0].replace(/\s/g,""),u=a[1].replace(/\s/g,""),h=A.translateOperatorToHuman(u));if(o){var m=A.getColumnConfig(e.props.dbIndex,e.extractTableNameFromURL(t[0],!0),o,"rename");c=m||o}l=l.replace(o,c).replace(u,h).replace(/\t/g," . . ");var p=A.elementPositionInArray(a,n);return l.length>50&&(l=l.substring(0,50)+"..."),i.a.createElement(R.a,{secondary:l,key:r+a,style:p>3?s:null})}))))}var l=A.elementPositionInArray(t,e.state.historyArray);return i.a.createElement(x.a,{button:!0,key:l,onMouseEnter:e.changeDisplayIndex.bind(e,l),onClick:e.handleHistoryItemClick.bind(e,l)},i.a.createElement(B.a,{id:"tooltip-bottom",title:"Copy shareable link",placement:"bottom"},i.a.createElement(L.a,{style:H.noStyleButton,onClick:e.handleLinkIconClick.bind(e,l)},i.a.createElement(M.a,null))),i.a.createElement(i.a.Fragment,null,i.a.createElement(R.a,{primary:a}),i.a.createElement(R.a,{secondary:"Get random rows...",key:l+a})))}return null}))),i.a.createElement(D.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.snackBarVisibility,onClose:function(){e.setState({snackBarVisibility:!1})},ContentProps:{"aria-describedby":"message-id"},message:i.a.createElement("span",{id:"message-id"},this.state.snackBarMessage),action:[i.a.createElement(T.a,{key:"close","aria-label":"Close",color:"secondary",style:H.close,onClick:function(){e.setState({snackBarVisibility:!1})}}," ",i.a.createElement(j.a,null)," ")]}));return i.a.createElement(S.a,{anchor:"right",open:this.props.historyPaneVisibility,onClose:this.closeDrawer},i.a.createElement("div",{tabIndex:0,role:"button"},t))}}]),a}(n.Component),H={root:{width:"30%",height:"100%",float:"right"},list:{width:400},listFull:{width:"auto"},noStyleButton:{border:"none",fill:E.a[700]},subheaderBackgroundColour:{background:E.a[500]},hide:{display:"none"}},U=a(164),K=a(298),z=a(42),J=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).handleClickListItem=function(e){n.setState({open:!0,anchorEl:e.currentTarget})},n.handleMenuItemClick=function(e,t){n.setState({open:!1}),n.props.changeDbIndex(t)},n.handleRequestClose=function(){n.setState({open:!1})},n.state={anchorEl:void 0,open:!1,databases:[]},n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=[];z.getValueFromConfig("databases").map((function(t,a){return e[a]=t.title||"Untitled database"})),this.setState({databases:e})}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement(O.a,null,i.a.createElement(x.a,{button:!0,"aria-haspopup":"true","aria-controls":"lock-menu","aria-label":"Database",onClick:this.handleClickListItem},i.a.createElement(R.a,{primary:"Database",secondary:this.state.databases[this.props.dbIndex]}))),i.a.createElement(U.a,{id:"lock-menu",anchorEl:this.state.anchorEl,open:this.state.open,onClose:this.handleRequestClose},this.state.databases.map((function(t,a){return i.a.createElement(K.a,{key:t,selected:a===e.props.dbIndex,onClick:function(t){return e.handleMenuItemClick(t,a)}},t)}))))}}]),a}(n.Component),W=a(40),Q=a(299),$=a(324),G=a(145),X=a.n(G),Y=a(144),Z=a.n(Y),ee=a(147),te=a.n(ee),ae=a(146),ne=a.n(ae),ie=a(148),re=a.n(ie),se=a(106),le=a.n(se),oe=a(64),ce=a.n(oe),ue=a(95),he=a(42),de=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).mounted=!1,n.handleRequestClose=function(){n.setState({snackBarVisibility:!1})},n.handleSearchClose=function(){n.setState({searchTerm:"",searchResults:{}}),n.props.changeSearchTerm("")},n.state={table:e.table,dbSchema:null,dbFkSchema:null,dbPkInfo:null,primaryKeysAvailable:!1,tables:[],snackBarVisibility:!1,snackBarMessage:"Unknown error occured",searchTerm:""},n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.mounted=!0;var e=he.getDbConfig(this.props.dbIndex,"url");e&&this.getDbSchema(e)}},{key:"componentWillUnmount",value:function(){g.a.cancelAll(),this.mounted=!1}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.props.dbIndex!==e.dbIndex?this.setState({table:"",dbSchema:null,dbFkSchema:null,tables:[]},(function(){this.props.changeTable(""),this.props.changeColumns(this.state[""]),this.getDbSchema(null),this.updateVisibleColumns(),this.handleSearchClose()})):this.state.table!==e.table?(this.setState({table:e.table}),this.handleTableClick(e.table)):this.state.searchTerm!==e.searchTerm?this.setState({searchTerm:e.searchTerm},(function(){t.setState({searchResults:t.searchTablesColumnsFK()})})):this.props.token!==e.token&&this.getDbSchema(he.getDbConfig(this.props.dbIndex,"url"),e.token)}},{key:"hasForeignKey",value:function(e,t){var a;return(a=ue.find(this.state.dbFkSchema,(function(a){return a.table_name===e&&a.column_name===t})))!=={}&&null!==a&&void 0!==a&&a}},{key:"isForeignKey",value:function(e,t){var a;if((a=ue.filter(this.state.dbFkSchema,(function(a){return a.foreign_table===e&&a.foreign_column===t})))==={}||null===a||void 0===a)return!1;var n="";return ue.forEach(a,(function(e){n+=e.table_name+"."+e.column_name+", "})),""!==n&&(n=n.replace(/,\s$/g,"")),n}},{key:"searchTablesColumnsFK",value:function(){var e={},t="",a="",n="",i=this.state.searchTerm.toLowerCase().match(/(?:[^\s"]+|"[^"]*")+/g);return ue.forEach(i,(function(e){e&&(e.indexOf("[table]")>-1||e.indexOf("[tables]")>-1?a+=" "+e.replace("[table]","").replace("[tables]",""):e.indexOf("[column]")>-1||e.indexOf("[columns]")>-1?n+=" "+e.replace("[column]","").replace("[columns]",""):t+=" "+e)})),(t||a)&&ue.forEach(this.searchTables(t+a),(function(t){e[t]=[]})),(t||n)&&ue.forEach(this.searchColumns(t+n),(function(t){e[t[0]]=t[1]})),!0===he.getDbConfig(this.props.dbIndex,"foreignKeySearch")&&void 0!==this.state.dbFkSchema&&null!==this.state.dbFkSchema?this.addForeignKeyResults(e):e}},{key:"searchTables",value:function(e){var t=this,a=[];e=e.toLowerCase().match(/(?:[^\s"]+|"[^"]*")+/g);for(var n=function(n){var i=e[n].replace(/"/g,"");if(""!==i){var r=t.state.tables.filter((function(e){return e.toLowerCase().indexOf(i)>-1})),s=t.state.tables.filter((function(e){var a=he.getTableConfig(t.props.dbIndex,e,"rename");return(a||e).toLowerCase().indexOf(i)>-1}));a.push(r),a.push(s)}},i=0;i<e.length;i++)n(i);return ue.uniq(ue.flattenDeep(a))}},{key:"searchColumns",value:function(e){var t=this,a=[];e=e.toLowerCase().match(/(?:[^\s"]+|"[^"]*")+/g);for(var n=function(n){var i=e[n].replace(/"/g,"");""!==i&&a.push(t.state.tables.map((function(e){var a=[],n=t.state[e],r=ue.compact(n.filter((function(e){return e.toLowerCase().indexOf(i)>-1}))),s=ue.compact(n.filter((function(a){var n=he.getColumnConfig(t.props.dbIndex,e,a,"rename");return(n||a).toLowerCase().indexOf(i)>-1})));return a.push(r),a.push(s),r.length>0||s.length>0?[e,{columns:ue.uniq(ue.flattenDeep(a))}]:[]})))},i=0;i<e.length;i++)n(i);return ue.uniq(ue.compact(ue.flatten(a)))}},{key:"addForeignKeyResults",value:function(e){var t=this,a=e;return ue.keys(e).forEach((function(n){void 0!==n&&void 0!==e[n]&&void 0!==e[n].columns&&ue.forEach(e[n].columns,(function(e){var i=ue.find(t.state.dbFkSchema,(function(t){return t.table_name===n&&t.column_name===e}));void 0!==i&&(a[n].foreign_keys={},a[n].foreign_keys[e]={foreign_table:i.foreign_table,foreign_column:i.foreign_column},a[i.foreign_table]&&a[i.foreign_table].columns?-1===ue.find(a[i.foreign_table].columns,i.foreign_column)&&(a[i.foreign_table].columns=a[i.foreign_table].columns.push(i.foreign_column)):!a[i.foreign_table]||null!==a[i.foreign_table].columns&&void 0!==a[i.foreign_table].columns?(a[i.foreign_table]={},a[i.foreign_table].columns=[i.foreign_column]):a[i.foreign_table].columns=a[i.foreign_table].columns.push(i.foreign_column))}))})),a}},{key:"getDbSchema",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he.getDbConfig(this.props.dbIndex,"url"),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t||(t=he.getDbConfig(this.props.dbIndex,"url"));var n={};a&&(n={Authorization:"Bearer "+a}),g.a.get(t+"/",{headers:n}).then((function(t){e.mounted&&e.setState({dbSchema:t.data},(function(){e.parseDbSchema(t.data)}))})).catch((function(t){e.mounted&&e.setState({snackBarVisibility:!0,snackBarMessage:"Database does not exist."},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),5e3)}))})),!0===he.getDbConfig(this.props.dbIndex,"foreignKeySearch")&&g.a.get(t+"/rpc/foreign_keys",{headers:n}).then((function(t){e.mounted&&e.setState({dbFkSchema:t.data})})).catch((function(t){e.mounted&&e.setState({snackBarVisibility:!0,snackBarMessage:"Foreign keys function does not exist in database."},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),5e3)}))})),!0===he.getDbConfig(this.props.dbIndex,"primaryKeyFunction")&&null!==a&&g.a.get(t+"/rpc/primary_keys",{headers:n}).then((function(t){if(e.mounted){var a="[]"!==JSON.stringify(t.data[0].primary_keys);e.setState({dbPkInfo:t.data[0].primary_keys,primaryKeysAvailable:a},(function(){a&&e.props.changeDbPkInfo(t.data)}))}})).catch((function(t){e.mounted&&e.setState({snackBarVisibility:!0,snackBarMessage:"Primary keys function does not exist in database."},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),5e3)}))}))}},{key:"parseDbSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.dbSchema;this.props.changeDbSchemaDefinitions(e.definitions);var t=[];for(var a in e.definitions)!1!==he.getTableConfig(this.props.dbIndex,a,"visible")&&(t.push(a),this.parseTableColumns(e.definitions[a].properties,a));this.setState({tables:t}),""===t.join()?this.props.changeTable(""):void 0!==t[0]&&null!==t[0]&&""!==t[0]&&""===this.state.table?"change_log"===t[0]?this.handleTableClick(t[1]):this.handleTableClick(t[0]):this.handleTableClick(this.state.table,!0)}},{key:"parseTableColumns",value:function(e,t){var a=this,n=[];for(var i in e){if(!1!==he.getColumnConfig(this.props.dbIndex,t,i,"visible"))n.push(i),!1===he.isColumnInDefaultView(this.props.dbIndex,t,i)&&this.setState(Object(W.a)({},t+i+"Visibility","hide"))}this.setState(Object(W.a)({},t,n),(function(){t===a.state.table&&(a.props.changeTable(a.state.table),a.props.changeColumns(a.state[a.state.table]),a.updateVisibleColumns())}))}},{key:"handleTableOpenClick",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.state.hoverTable!==e||a?this.setState({hoverTable:e},(function(){t.updateVisibleColumnsOnHover()})):this.setState({hoverTable:""},(function(){t.updateVisibleColumnsOnHover()}))}},{key:"handleTableClick",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.state.table!==e||a?this.setState({table:e},(function(){t.props.changeTable(e),t.props.changeColumns(t.state[e]),t.updateVisibleColumns()})):this.setState({table:""},(function(){t.props.changeTable(""),t.props.changeColumns([]),t.updateVisibleColumns()}))}},{key:"handleColumnClick",value:function(e,t){var a=this;"hide"===this.state[t+e+"Visibility"]?this.setState(Object(W.a)({},t+e+"Visibility",""),(function(){a.updateVisibleColumns()})):this.setState(Object(W.a)({},t+e+"Visibility","hide"),(function(){a.updateVisibleColumns()}))}},{key:"createTableElement",value:function(e){var t=this,a=he.getTableConfig(this.props.dbIndex,e,"rename"),n=a||e,r=[],s=me.hide;if((""===this.state.searchTerm||this.state.searchResults&&void 0!==this.state.searchResults[e]&&null!==this.state.searchResults[e])&&(s=null),r.push(i.a.createElement(x.a,{button:!0,key:this.props.dbIndex+e,id:e,style:s||(this.state.table===e?me.primaryBackgroundFill:null),title:n,onClick:function(a){return t.handleTableClick(e)}},i.a.createElement(L.a,null,this.state.table===e?i.a.createElement(Z.a,{style:me.primaryColoured}):i.a.createElement(X.a,null)),i.a.createElement(R.a,{primary:n,style:{textOverflow:"clip",overflow:"hidden",width:"29%",height:20}}),i.a.createElement(L.a,{onClick:function(a){a.stopPropagation(),t.handleTableOpenClick(e)},title:"Show columns without loading in Query Builder."},this.state.hoverTable===e?this.state.table===e?i.a.createElement("div",null):i.a.createElement(ne.a,{style:me.primaryColoured}):this.state.table===e?i.a.createElement("div",null):i.a.createElement(te.a,null)))),"phylogenetic_tree"!==e){var l=[];for(var o in this.state[e]){var c=this.state[e][o];l.push(this.createColumnElement(c,e))}r.push(i.a.createElement(Q.a,{in:this.state.table===e||this.state.hoverTable===e,timeout:"auto",key:this.props.dbIndex+e+"collspsibleCols"},i.a.createElement(O.a,{component:"div",key:this.props.dbIndex+e+"cols"},l)))}else r.push(i.a.createElement(x.a,{button:!0,title:"Administrator has hidden the columns ... can work with them in query builder",key:"hiddenColsOf"+e+this.props.dbIndex,style:this.state.table!==e&&this.state.hoverTable!==e?Object(v.a)(Object(v.a)({},me.column),me.hide):me.column},i.a.createElement(L.a,null,i.a.createElement(le.a,null)),i.a.createElement(R.a,{secondary:"*Too many Columns...*"})));return r}},{key:"createColumnElement",value:function(e,t){var a=this,n=he.getColumnConfig(this.props.dbIndex,t,e,"rename"),r=n||e,s="hide"!==this.state[t+e+"Visibility"],l=me.column;if(""!==this.state.searchTerm&&this.state.searchResults&&(void 0===this.state.searchResults[t]||null===this.state.searchResults[t]))return l=Object(v.a)(Object(v.a)({},me.column),me.hide),null;var o=this.isForeignKey(t,e),c="Ref. by "+o,u=this.hasForeignKey(t,e),h="FK to "+u.foreign_table+"."+u.foreign_column;return h.length>15&&(h=h.substring(0,15)+"..."),c.length>15&&(c=c.substring(0,15)+"..."),i.a.createElement(x.a,{button:!0,key:e+t+this.props.dbIndex,id:e,title:r,style:l,onClick:function(n){return a.handleColumnClick(e,t)}},i.a.createElement(L.a,null,s?i.a.createElement(re.a,{style:me.primaryColoured}):i.a.createElement(le.a,null)),i.a.createElement(R.a,{secondary:r}),!1===u?null:i.a.createElement($.a,{style:{maxWidth:175},label:h,title:"Foreign Key to "+u.foreign_table+"."+u.foreign_column}),""===o?null:i.a.createElement($.a,{style:{maxWidth:175},label:c,title:"Referenced by "+o}))}},{key:"updateVisibleColumns",value:function(){var e=this.state[this.state.table],t={},a=[];if(void 0!==e)for(var n=0;n<e.length;n++){var i="hide"!==this.state[this.state.table+e[n]+"Visibility"];t[e[n]]=i,i&&a.push(e[n])}this.props.changeVisibleColumns(a)}},{key:"updateVisibleColumnsOnHover",value:function(){var e=this.state[this.state.hoverTable],t={},a=[];if(void 0!==e)for(var n=0;n<e.length;n++){var i="hide"!==this.state[this.state.hoverTable+e[n]+"Visibility"];t[e[n]]=i,i&&a.push(e[n])}}},{key:"render",value:function(){var e=this,t=this.state.searchTerm;return t.length>34&&(t=t.substring(0,34),t+=" ..."),i.a.createElement(i.a.Fragment,null,""!==this.state.searchTerm?i.a.createElement($.a,{label:"Searching: "+t,style:me.chipClasses,onDelete:this.handleSearchClose}):null,i.a.createElement(D.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.snackBarVisibility,onClose:this.handleRequestClose,ContentProps:{"aria-describedby":"message-id"},message:i.a.createElement("span",{id:"message-id"},this.state.snackBarMessage),action:[i.a.createElement(T.a,{key:"close","aria-label":"Close",color:"secondary",style:me.close,onClick:this.handleRequestClose}," ",i.a.createElement(j.a,null)," ")]}),""!==this.state.tables.join("")&&i.a.createElement(O.a,{subheader:i.a.createElement(F.a,{component:"div",style:me.subheaderBackground},"Tables and Columns")},this.state.tables.map((function(t){return e.createTableElement(t)}))))}}]),a}(n.Component),me={column:{marginLeft:20},hide:{display:"none"},close:{width:20,height:20},primaryColoured:{fill:ce.a[400]},primaryBackgroundFill:{background:ce.a[100],marginLeft:"1%",borderRadius:5},chipClasses:{margin:5,marginTop:10,marginBottom:0},subheaderBackground:{background:"white"}},pe=function(e){var t=!0===e.leftPaneVisibility?be.root:be.rootHide;return i.a.createElement("div",{style:Object(v.a)({},t)},i.a.createElement(J,e),i.a.createElement(C.a,null),i.a.createElement(de,e))},be={root:{width:"29%",height:"100%",float:"left",opacity:1,visibility:"visible",transition:"width 0.25s, visibility 0.2s, opacity 0.12s"},rootHide:{width:"0%",height:"100%",float:"left",opacity:0,visibility:"hidden",transition:"width 0.25s, visibility 0.2s, opacity 0.12s"},column:{marginLeft:27},lowBottomPadding:{paddingBottom:0}},ge=a(300),fe=a(305),ye=a(302),ve=a(303),Ce=a(301),ke=a(318),we=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={email:null,password:null},n.onChangeHandler=n.onChangeHandler.bind(Object(c.a)(n)),n.handleLoginClick=n.handleLoginClick.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"handleLoginClick",value:function(e){this.state.email&&this.state.password&&(this.props.setUserEmailPassword(this.state.email,this.state.password),this.props.handleLoginDialogCloseClick(e))}},{key:"onChangeHandler",value:function(e){this.setState(Object(W.a)({},e.target.id,e.target.value))}},{key:"render",value:function(){return i.a.createElement(ge.a,{open:this.props.open||!1,onClose:this.props.handleLoginDialogCloseClick,"aria-labelledby":"form-dialog-title"},i.a.createElement(Ce.a,{id:"form-dialog-title"},"Dandelion Explorer ",this.props.dbName?" - "+this.props.dbName:""),i.a.createElement(ye.a,null,i.a.createElement(ve.a,null,"Provide your credentials for this database, it may allow you more privileges."),i.a.createElement(ke.a,{autoFocus:!0,required:!0,margin:"dense",id:"email",label:"Email Address",type:"email",onChange:this.onChangeHandler,fullWidth:!0}),i.a.createElement(ke.a,{required:!0,margin:"dense",id:"password",label:"Password",type:"password",onChange:this.onChangeHandler,fullWidth:!0})),i.a.createElement(C.a,null),i.a.createElement(fe.a,null,i.a.createElement(k.a,{onClick:this.props.handleLoginDialogCloseClick,color:"default"},"Cancel"),i.a.createElement(k.a,{onClick:this.handleLoginClick,color:"secondary"},"Login")))}}]),a}(n.Component),Ee=a(240),Se=a(306),Te=a(307),Oe=a(38),xe=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"transition",value:function(e){return i.a.createElement(Ee.a,Object.assign({direction:"up"},e))}},{key:"render",value:function(){var e=this.props.tool;return i.a.createElement(ge.a,{fullScreen:!0,open:this.props.open,onClose:this.props.handleHelpToggle,TransitionComponent:this.transition},i.a.createElement(Se.a,{style:Le.appBar},i.a.createElement(Te.a,null,i.a.createElement(T.a,{color:"default",onClick:this.props.handleHelpToggle,"aria-label":"Close"},i.a.createElement(j.a,null)),i.a.createElement(Oe.a,{variant:"title",color:"default",style:Le.flex},e.label))),i.a.createElement("iframe",{style:{height:"100%"},src:e.url}))}}]),a}(n.Component),Le={appBar:{position:"relative",color:"black",background:E.a[600]},flex:{flex:1},centered:{marginLeft:"auto",marginRight:"auto",marginTop:20}},Re=a(308),Fe=a(88),De=a.n(Fe),Be=a(149),Ie=a.n(Be),je=a(150),Pe=a.n(je),Ne=a(151),qe=a.n(Ne),Me=function(e){var t=document.createElement("style"),a=null;document.head.appendChild(t),(a=t.sheet).insertRule(e,a.cssRules.length)},_e=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),n=t.call(this,e),Me("\n    @keyframes innerPulse {\n      0%      { transform: scale(1.0); }    \n      100%    { transform: scale(1.1); }\n    }"),Me("\n    @keyframes outerPulse {\n      0%      { transform: scale(1.0); opacity: 0.9 }    \n      100%    { transform: scale(2.0); opacity: 0.0 }\n    }"),n.state={pos:{top:1,right:1,bottom:1,left:1,width:1}},n.handleResize=function(){n.onResize(window.innerWidth)},n.handleClick=function(e){n.node.contains(e.target)||n.props.onClose()},n}return Object(o.a)(a,[{key:"onResize",value:function(){this.getComponentPosition();var e=window.innerWidth*window.devicePixelRatio,t=window.innerHeight*window.devicePixelRatio/2/this.state.pos.top<1,a=e/2/this.state.pos.top>1,n=e-(this.state.pos.left+this.state.pos.width/2);this.setState({drawTextAboveCenter:t,drawTextLeftOfCenter:a,minimalDistanceToViewport:n})}},{key:"getStyles",value:function(){var e=this.props.backgroundColor,t=this.state,a=t.pos,n=t.open,i=t.drawTextAboveCenter,r=t.minimalDistanceToViewport,s=a.width+40,l=Math.min(window.innerWidth,900),o=1/l*900*50,c=l/2+Math.min(r,l/2)-(o+20);return{root:{zIndex:1e3},circles:{position:"absolute",top:a.top-(this.props.subtractFromTopPos||20),left:a.left-20,opacity:n?1:0,pointerEvents:n?"inherit":"none"},pulseInnerCircle:{position:"absolute",transformOrigin:"center center",height:"".concat(s,"px"),width:"".concat(s,"px"),borderRadius:"50%",backgroundColor:"white",animation:n?"innerPulse 872ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) alternate infinite":null,transform:n?"scale(1)":"scale(0)",transition:"transform 225ms cubic-bezier(0.4, 0, 0.2, 1)"},pulseOuterCircle:{position:"absolute",transformOrigin:"center center",height:"".concat(s,"px"),width:"".concat(s,"px"),borderRadius:"50%",backgroundColor:"white",opacity:0,animation:n?"outerPulse 1744ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite":null},outerCircle:{position:"absolute",transformOrigin:"center center",transform:n?"scale(1.0)":"scale(0.8)",transition:"transform 225ms cubic-bezier(0.4, 0, 0.2, 1), opacity 225ms cubic-bezier(0.4, 0, 0.2, 1)",marginTop:"-".concat(l/2-s/2,"px"),marginLeft:"-".concat(l/2-s/2,"px"),height:"".concat(l,"px"),width:"".concat(l,"px"),borderRadius:"50%",backgroundColor:e,opacity:n?this.props.opacity:0},textBox:{fontFamily:"Roboto",position:"relative",zIndex:25e3,paddingLeft:o*(this.props.customPaddingLeft||1),paddingRight:20,width:c||0,height:100,marginTop:i?l/2-s/2-100-20:l/2+s/2+20,color:"white",fontSize:"16pt"}}}},{key:"close",value:function(){null!=this.content&&this.setState({pos:this.content.getBoundingClientRect(),open:!1})}},{key:"open",value:function(){null!=this.content&&(this.handleResize(),this.setState({pos:this.content.getBoundingClientRect(),open:!0}))}},{key:"componentDidMount",value:function(){var e=this;this.handleResize(),window.addEventListener("resize",this.handleResize),window.addEventListener("scroll",this.handleResize),window.addEventListener("mousedown",this.handleClick,!1),this.content=Object(r.findDOMNode)(this.props.element),this.setState({pos:this.content.getBoundingClientRect()}),this.updateInterval=setInterval((function(){e.getComponentPosition()}),50)}},{key:"getComponentPosition",value:function(){if(this.state.open){var e=this.content.getBoundingClientRect();e.top===this.state.pos.top&&e.left===this.state.pos.left||this.setState({pos:e})}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("scroll",this.handleResize),window.removeEventListener("mousedown",this.handleClick,!1),clearInterval(this.updateInterval),this.content=null}},{key:"render",value:function(){var e=this,t=this.getStyles();return i.a.createElement("div",{ref:function(t){return e.node=t},style:t.root},i.a.createElement("div",{style:t.circles},i.a.createElement("div",{style:t.outerCircle},i.a.createElement("div",{style:t.textBox},i.a.createElement(Oe.a,{variant:"h6",style:{color:"white"}},this.props.title),i.a.createElement("br",null),i.a.createElement(Oe.a,{variant:"body1",style:{color:"white"}},this.props.description))),i.a.createElement("div",{style:t.pulseInnerCircle}),i.a.createElement("div",{style:t.pulseOuterCircle})))}}]),a}(n.Component),Ae=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={pos:{top:1,right:1,bottom:1,left:1,width:1}},n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.portal=document.createElement("div"),document.body.appendChild(this.portal),this.portal.style.position="fixed",this.portal.style.zIndex=1,this.portal.style.top=0,this.portal.style.left=0,this.renderCircle()}},{key:"componentWillUnmount",value:function(){Object(r.unmountComponentAtNode)(this.portal),this.portal=null}},{key:"componentWillReceiveProps",value:function(e){null!==this.circles&&void 0!==this.circles&&(e.open&&!this.props.open?this.circles.open():!e.open&&this.props.open&&this.circles.close())}},{key:"componentDidUpdate",value:function(){this.renderCircle()}},{key:"renderCircle",value:function(){var e=this;if(null==this.circles){var t=this.props,a=t.backgroundColor,n=t.description,s=t.onClose,l=t.title;Object(r.render)(i.a.createElement(_e,Object.assign({backgroundColor:a,description:n,element:this,onClose:s},this.props,{ref:function(t){e.circles=t},title:l})),this.portal)}}},{key:"render",value:function(){var e=i.a.Children.only(this.props.children);return i.a.cloneElement(e,{style:Object(v.a)(Object(v.a)({},e.props.style),{},{position:null!=e.props.style&&null!=e.props.style.position&&"static"!==e.props.style.position?e.props.style.position:"relative",zIndex:this.props.open?2:1})})}}]),a}(n.Component),Ve=a(87),He=a.n(Ve),Ue=a(95),Ke=a(42),ze=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).handleLoginButtonClick=function(){n.props.isLoggedIn?n.props.handleLogoutClick():n.setState({loginDialogOpen:!n.state.loginDialogOpen})},n.handleLoginDialogCloseClick=function(){n.setState({loginDialogOpen:!1})},n.handleHelpToggle=function(e){n.setState({isHelpOpen:!n.state.isHelpOpen})},n.state={isSearchBarFdpOpen:!1,isLoginFdpOpen:null,loginDialogOpen:!1,isHelpOpen:!1},n.changeSearchTermDebounce=Ue.debounce((function(e){n.props.changeSearchTerm(e),n.setState({isSearchBarFdpOpen:!0})}),350),n}return Object(o.a)(a,[{key:"componentWillReceiveProps",value:function(e){"private"!==e.publicDBStatus&&"read"!==e.publicDBStatus||e.isLoggedIn||null===this.state.isLoginFdpOpen&&this.setState({isLoginFdpOpen:!0})}},{key:"changeSearchTerm",value:function(e){this.changeSearchTermDebounce(e.target.value)}},{key:"render",value:function(){var e=this,t=Ke.getDbConfig(this.props.dbIndex,"title")||"Untitled database",a=Ke.getDbConfig(this.props.dbIndex,"tool"),n=null;return n=this.state.isSearchBarFdpOpen?{backgroundColor:"white",border:"1px solid grey",width:"325px",minWidth:"inherit"}:{backgroundColor:"rgba(255, 255, 255, 0.1)",border:"none",width:"45%",maxWidth:"525px",minWidth:"325px"},document.title=t.replace("Database","db").replace("database","db"),i.a.createElement(i.a.Fragment,null,i.a.createElement(Se.a,{position:"absolute"},i.a.createElement(Te.a,null,i.a.createElement(Ae,{onClose:function(){return e.setState({isSearchBarFdpOpen:!1})},open:!this.props.leftPaneVisibility&&""===this.props.table&&!this.state.isSearchBarFdpOpen,backgroundColor:He.a[500],title:"Welcome to Dandelion Explorer!",customPaddingLeft:8.5,subtractFromTopPos:0,opacity:.95,description:"Choose a table to query from the database schema."},i.a.createElement(T.a,{color:"inherit","aria-label":"Menu",onClick:this.props.toggleLeftPane.bind(this)},i.a.createElement(Ie.a,null))),i.a.createElement(Oe.a,{variant:"h6",color:"inherit",style:Je.dbTitleFlex},"Dandelion Explorer"),i.a.createElement("div",{style:Je.searchBarFlex},i.a.createElement(Ae,{onClose:function(){return e.setState({isSearchBarFdpOpen:!1})},open:this.state.isSearchBarFdpOpen,backgroundColor:ce.a[500],title:"Search Tables and Columns",customPaddingLeft:2,subtractFromTopPos:200,opacity:.95,description:"Can also tag each term with '[table]' or '[column]'. For example, people[table] firstname[column]."},i.a.createElement(ke.a,{id:"search",placeholder:"Search",onKeyPress:this.changeSearchTerm.bind(this),onChange:this.changeSearchTerm.bind(this),onFocus:this.changeSearchTerm.bind(this),type:"search",style:Object(v.a)(Object(v.a)({},Je.searchBar),n),InputProps:{startAdornment:i.a.createElement(Re.a,{position:"start"},i.a.createElement(De.a,{style:this.state.isSearchBarFdpOpen?{fill:"rgba(0,0,0,0.5)"}:{fill:"rgba(255,255,255,0.75)"}}))},autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false"}))),i.a.createElement(T.a,{style:Je.rightIconsFlex,color:"inherit","aria-label":"History",onClick:this.props.toggleHistoryPane.bind(this),title:"Query history"},i.a.createElement(Pe.a,{style:Je.floatRight})),i.a.createElement(T.a,{style:Je.rightIconsFlex,color:"inherit","aria-label":"Help",onClick:this.handleHelpToggle,title:a.label},i.a.createElement(qe.a,{style:Je.floatRight}))),i.a.createElement(we,{dbName:t.replace("Database","db").replace("database","db"),setUserEmailPassword:this.props.setUserEmailPassword,open:this.state.loginDialogOpen,handleLoginDialogCloseClick:this.handleLoginDialogCloseClick}),i.a.createElement(xe,{open:this.state.isHelpOpen,handleHelpToggle:this.handleHelpToggle,tool:a})))}}]),a}(n.Component),Je={dbTitleFlex:{flex:.3},searchBarFlex:{flex:.6,display:"block",marginLeft:5,marginRight:5,marginTop:0},searchBar:{marginLeft:5,marginRight:5,background:"white",padding:10,paddingBottom:5,borderRadius:3,float:"right",transition:"all 0.2s"},rightIconsFlex:{flex:.05,display:"block"},floatRight:{float:"right"},floatRightPadded:{float:"right",marginRight:5},button:{margin:15}},We=a(152),Qe=a.n(We),$e=a(109),Ge=a(317),Xe=a(310),Ye=a(91),Ze=a.n(Ye),et=a(65),tt=a.n(et),at=a(309),nt=a(154),it=a.n(nt),rt=a(153),st=a.n(rt),lt=function(e){var t=null;return e.success&&(t=Object(v.a)({},ot.successButton)),e.success&&e.error&&(t=Object(v.a)({},ot.errorButton)),i.a.createElement("div",{style:ot.wrapper},i.a.createElement(at.a,{color:"secondary",style:t,onClick:e.getRules},e.success?e.error?i.a.createElement(j.a,null):i.a.createElement(st.a,null):i.a.createElement(it.a,null)),e.loading&&i.a.createElement(Xe.a,{size:68,style:ot.progress}))},ot={wrapper:{marginRight:"5%",position:"relative"},successButton:{backgroundColor:Ze.a[500],"&:hover":{backgroundColor:Ze.a[700]}},errorButton:{backgroundColor:tt.a[500],"&:hover":{backgroundColor:tt.a[700]}},progress:{color:Ze.a[500],position:"absolute",top:-6,left:-6,zIndex:5}},ct=a(312),ut=a(320),ht=a(316),dt=a(163),mt=a(108),pt=a(107),bt=a(155),gt=a(319),ft=a(311),yt=a(304),vt=a(241),Ct=a(157),kt=a.n(Ct),wt=a(156),Et=a.n(wt),St=a(42),Tt=a(230),Ot=a(231),xt=function(e){Object(u.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).handleFileFormatChange=function(e,t){"delimiterInput"!==e.target.id&&a.setState({fileFormat:t},(function(){a.createFileName(),a.setState({fileNameCustom:""})}))},a.handleClickListItem=function(e){a.setState({open:!0,anchorEl:e.currentTarget})},a.handleMenuItemClick=function(e,t){a.setState({columnChosen:t,open:!1})},a.handleRequestClose=function(){a.setState({open:!1})},a.state={table:e.table,columns:e.columns,data:[],dataFull:[],url:e.url,fileFormat:"delimited",delimiterChoice:",",columnChosen:0,tableHeader:!0,batchDownloadCheckBox:!1,copyUniqueValuesOnlyToggle:!1,fileNameCustom:"",reRunQuery:!1,fileNameAuto:"",anchorEl:void 0,open:!1,copyLoading:!1,copyResult:"",batchSize:"100K",batchDownloadLowerNum:0,batchDownloadUpperNum:1e5,snackBarVisibility:!1,snackBarMessage:"Unknown error occured"},a.handleDelimiterChange=a.handleDelimiterChange.bind(Object(c.a)(a)),a.handlebatchDownloadCheckBox=a.handlebatchDownloadCheckBox.bind(Object(c.a)(a)),a.handleCopyUniqueValuesOnlyToggle=a.handleCopyUniqueValuesOnlyToggle.bind(Object(c.a)(a)),a.handleLeftButtonClickRangeDownload=a.handleLeftButtonClickRangeDownload.bind(Object(c.a)(a)),a.handleRightButtonClickRangeDownload=a.handleRightButtonClickRangeDownload.bind(Object(c.a)(a)),a.handleTableHeaderToggle=a.handleTableHeaderToggle.bind(Object(c.a)(a)),a.handleFileNameChange=a.handleFileNameChange.bind(Object(c.a)(a)),a.handleCopyOutputClick=a.handleCopyOutputClick.bind(Object(c.a)(a)),a.handleDownloadClick=a.handleDownloadClick.bind(Object(c.a)(a)),a.handleCopyClick=a.handleCopyClick.bind(Object(c.a)(a)),a.handleResetClick=a.handleResetClick.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({table:e.table,columns:e.columns,url:e.url,data:e.data,fileNameCustom:"",dataFull:[],columnChosen:0},(function(){t.createFileName()}))}},{key:"downloadFile",value:function(e,t,a){""===this.state.fileNameCustom?window.download(e,t,a):window.download(e,this.state.fileNameCustom,a)}},{key:"createFileName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.state.delimiterChoice.replace(/\\t/g,"\t"),a=this.state.url.replace(St.getDbConfig(this.props.dbIndex,"url")+"/","").replace("?","-").replace(/&/g,"-").replace(/=/g,"-").replace(/\([^()]{15,}\)/g,"(vals)").replace(/\(([^()]|\(vals\)){50,}\)/g,"(nested-vals)").replace(/[.]([\w,"\s]{30,})[,]/g,"(in-vals)");return!0!==this.state.batchDownloadCheckBox&&!0!==e||(a=a.replace(/limit-\d*/g,"limit-2500000-range-"+this.state.batchDownloadLowerNum+"-"+this.state.batchDownloadUpperNum)),"delimited"===this.state.fileFormat?(a+=","===t?".csv":"\t"===t?".tsv":".txt",!0===this.state.tableHeader&&(a=a.replace(".csv","-header.csv").replace(".tsv","-header.tsv").replace(".txt","-header.txt"))):"xml"===this.state.fileFormat?a+=".xml":"json"===this.state.fileFormat?a+=".json":"fasta"===this.state.fileFormat?a+=".fasta":a+=".txt",this.setState({fileNameAuto:a}),a}},{key:"downloadTableWithDelimiter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===e&&"[]"!==JSON.stringify(this.state.data))try{var t=this.state.delimiterChoice.replace(/\\t/g,"\t"),a=Tt.parse(this.state.data,{fields:this.state.columns,delimiter:t,header:this.state.tableHeader}),n=this.createFileName();this.downloadFile(a,n,"text/plain")}catch(l){console.error(l)}else if(!0===e&&"[]"!==JSON.stringify(this.state.dataFull))try{var i=this.state.delimiterChoice.replace(/\\t/g,"\t"),r=Tt.parse(this.state.data,{fields:this.state.columns,delimiter:i,header:this.state.tableHeader}),s=this.createFileName(!0);this.downloadFile(r,s,"text/plain")}catch(l){console.error(l)}}},{key:"downloadTableAsJSON",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===e&&"[]"!==JSON.stringify(this.state.data))try{var t=JSON.stringify(this.state.data),a=this.createFileName();this.downloadFile(t,a,"text/plain")}catch(r){console.error(r)}else if(!0===e&&"[]"!==JSON.stringify(this.state.dataFull))try{var n=JSON.stringify(this.state.dataFull),i=this.createFileName(!0);this.downloadFile(n,i,"text/plain")}catch(r){console.error(r)}}},{key:"copyTableAsJSON",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===e&&"[]"!==JSON.stringify(this.state.data))try{var t=JSON.stringify(this.state.data);this.setState({copyResult:t});var a=this.insertToClipboard(t);a&&this.setState({copyLoading:!1})}catch(r){console.error(r)}else if(!0===e&&"[]"!==JSON.stringify(this.state.dataFull))try{var n=JSON.stringify(this.state.dataFull),i=this.insertToClipboard(n);i&&this.setState({copyLoading:!1})}catch(r){console.error(r)}}},{key:"downloadTableAsXML",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===e&&"[]"!==JSON.stringify(this.state.data))try{var t=Ot.parse(this.state.table,this.state.data),a=this.createFileName();this.downloadFile(t,a,"text/plain")}catch(r){console.error(r)}else if(!0===e&&"[]"!==JSON.stringify(this.state.dataFull))try{var n=Ot.parse(this.state.table,this.state.dataFull),i=this.createFileName(!0);this.downloadFile(n,i,"text/plain")}catch(r){console.error(r)}}},{key:"copyTableAsXML",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===e&&"[]"!==JSON.stringify(this.state.data))try{var t=Ot.parse(this.state.table,this.state.data),a=this.insertToClipboard(t);a&&this.setState({copyLoading:!1})}catch(r){console.error(r)}else if(!0===e&&"[]"!==JSON.stringify(this.state.dataFull))try{var n=Ot.parse(this.state.table,this.state.dataFull),i=this.insertToClipboard(n);i&&this.setState({copyLoading:!1})}catch(r){console.error(r)}}},{key:"identifySeqColumnInStateColumns",value:function(){return null}},{key:"downloadTableAsFASTA",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.identifySeqColumnInStateColumns();if(null!==t){if(!1===e&&"[]"!==JSON.stringify(this.state.data))try{var a="";for(var n in this.state.data){var i=this.state.data[n],r=i[t],s=">";for(var l in this.state.columns)this.state.columns[l]!==t&&(s+="|"+i[this.state.columns[l]]);a+=s.replace(">|",">"),a+="\n",a+=r,a+="\n"}var o=this.createFileName();this.downloadFile(a,o,"text/plain")}catch(g){console.error(g)}else if(!0===e&&"[]"!==JSON.stringify(this.state.dataFull))try{var c="";for(var u in this.state.dataFull){var h=this.state.dataFull[u],d=h[t],m=">";for(var p in this.state.columns)this.state.columns[p]!==t&&(m+="|"+h[this.state.columns[p]]);c+=m.replace(">|",">"),c+="\n",c+=d,c+="\n"}var b=this.createFileName(!0);this.downloadFile(c,b,"text/plain")}catch(g){console.error(g)}}else this.handleResetClick()}},{key:"insertToClipboard",value:function(e){document.oncopy=function(t){t.clipboardData.setData("text/plain",e),t.preventDefault()};var t=document.execCommand("copy");return document.oncopy=void 0,t}},{key:"handleTableHeaderToggle",value:function(){var e=this;this.setState({tableHeader:!this.state.tableHeader},(function(){e.createFileName()}))}},{key:"handlebatchDownloadCheckBox",value:function(){var e=this;this.setState({batchDownloadCheckBox:!this.state.batchDownloadCheckBox},(function(){e.createFileName()}))}},{key:"handleCopyUniqueValuesOnlyToggle",value:function(){this.setState({copyUniqueValuesOnlyToggle:!this.state.copyUniqueValuesOnlyToggle})}},{key:"handlebatchDownloadChange",value:function(e){var t=this;this.setState({batchSize:e,batchDownloadLowerNum:0,batchDownloadUpperNum:1e3*parseInt(e.replace("K",""),10)},(function(){t.createFileName(!0)}))}},{key:"handleLeftButtonClickRangeDownload",value:function(){var e=this,t=1e3*parseInt(this.state.batchSize.replace("K",""),10);this.state.batchDownloadLowerNum-t>this.props.totalRows?this.setState({batchDownloadLowerNum:Math.trunc(this.props.totalRows/t)*t,batchDownloadUpperNum:this.props.totalRows},(function(){e.createFileName(!0)})):this.state.batchDownloadLowerNum>0&&this.state.batchDownloadLowerNum-t>=0?this.setState({batchDownloadLowerNum:this.state.batchDownloadLowerNum-t,batchDownloadUpperNum:this.state.batchDownloadLowerNum},(function(){e.createFileName(!0)})):this.setState({batchDownloadLowerNum:0,batchDownloadUpperNum:t},(function(){e.createFileName(!0)}))}},{key:"handleRightButtonClickRangeDownload",value:function(){var e=this,t=1e3*parseInt(this.state.batchSize.replace("K",""),10);this.props.totalRows&&this.state.batchDownloadLowerNum+t+t>this.props.totalRows?this.setState({batchDownloadLowerNum:Math.trunc(this.props.totalRows/t)*t,batchDownloadUpperNum:this.props.totalRows},(function(){e.createFileName(!0)})):this.setState({batchDownloadLowerNum:this.state.batchDownloadLowerNum+t,batchDownloadUpperNum:this.state.batchDownloadLowerNum+t+t},(function(){e.createFileName(!0)}))}},{key:"handleDelimiterChange",value:function(e){var t=this,a=e.target.value;0===a.length?this.setState({delimiterChoice:","},(function(){t.createFileName(),t.setState({fileNameCustom:""})})):a.length<=5&&this.setState({delimiterChoice:a},(function(){t.createFileName(),t.setState({fileNameCustom:""})}))}},{key:"handleFileNameChange",value:function(e){var t=e.target.value;this.setState({fileNameCustom:t})}},{key:"handleResetClick",value:function(){var e=this;this.setState({fileFormat:"delimited",delimiterChoice:",",columnChosen:0,tableHeader:!0,batchDownloadCheckBox:!1,copyUniqueValuesOnlyToggle:!1,fileNameCustom:"",copyLoading:!1,copyResult:"",batchSize:"100K",batchDownloadLowerNum:0,batchDownloadUpperNum:1e5},(function(){e.createFileName()}))}},{key:"handleCopyClick",value:function(){var e=this;this.setState({copyLoading:!0},(function(){if(!0===e.state.batchDownloadCheckBox&&e.state.fileFormat,"delimited"===e.state.fileFormat);else if("delimitedColumn"===e.state.fileFormat){var t=e.state.columnChosen,a=e.state.data,n=e.state.columns,i="";if(e.state.copyUniqueValuesOnlyToggle){for(var r=new Set,s=0;s<a.length;s++)r.add(a[s][n[t]]);var l,o=Object(bt.a)(r.values());try{for(o.s();!(l=o.n()).done;){var c=l.value;String(c)&&String(c).match(/[\W|\s]/g)?i+='"'+c+'",':i+=c+","}}catch(m){o.e(m)}finally{o.f()}}else for(var u=0;u<a.length;u++){var h=a[u][n[t]];String(h)&&String(h).match(/[\W|\s]/g)?i+='"'+h+'",':i+=h+","}i=i.replace(/,$/g,"");var d=e.insertToClipboard(i);e.setState({copyLoading:!1,snackBarVisibility:!0,snackBarMessage:d?"Copied!":"Error copying data ..."},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),2500)}))}else"json"===e.state.fileFormat?e.copyTableAsJSON():"xml"===e.state.fileFormat?e.copyTableAsXML():e.state.fileFormat;e.setState({submitSuccess:!0,submitError:!1,submitLoading:!1,dataFull:[]})}))}},{key:"handleCopyOutputClick",value:function(){}},{key:"handleDownloadClick",value:function(){var e=this;this.createFileName(),this.setState({submitLoading:!0,submitSuccess:!1,submitError:!1,dataFull:[]},(function(){if(!0===e.state.batchDownloadCheckBox){var t=e.state.url.replace(/limit=\d*/g,"limit=2500000");e.fetchOutput(t)}else"delimited"===e.state.fileFormat?e.downloadTableWithDelimiter():"json"===e.state.fileFormat?e.downloadTableAsJSON():"xml"===e.state.fileFormat?e.downloadTableAsXML():"fasta"===e.state.fileFormat&&e.downloadTableAsFASTA(),e.setState({submitSuccess:!0,submitError:!1,submitLoading:!1,dataFull:[]})}))}},{key:"fetchOutput",value:function(e){var t=this,a={};!0===this.state.batchDownloadCheckBox&&(a={Range:String(this.state.batchDownloadLowerNum)+"-"+String(this.state.batchDownloadUpperNum-1),Accept:"application/json",Prefer:"count=exact"}),this.props.isLoggedIn&&this.props.token&&(a.Authorization="Bearer "+this.props.token),g.a.get(e,{headers:a,requestId:"qbAxiosReq"}).then((function(e){t.setState({dataFull:e.data,submitLoading:!1,submitError:!1,submitSuccess:!0},(function(){t.timer=setTimeout((function(){t.setState({submitLoading:!1,submitSuccess:!1,submitError:!1})}),2e3),"delimited"===t.state.fileFormat?t.downloadTableWithDelimiter(!0):"json"===t.state.fileFormat?t.downloadTableAsJSON(!0):"xml"===t.state.fileFormat?t.downloadTableAsXML(!0):"fasta"===t.state.fileFormat&&t.downloadTableAsFASTA(!0)}))})).catch((function(e){console.error("HTTP Req:",e),t.setState({dataFull:[],submitLoading:!1,submitSuccess:!0,submitError:!0},(function(){t.timer=setTimeout((function(){t.setState({submitLoading:!1,submitSuccess:!1,submitError:!1})}),2e3)}))}))}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement($e.a,{elevation:2,style:Lt.topMargin},i.a.createElement(Oe.a,{variant:"subtitle1",style:Lt.cardcardMarginLeftTop},"Download Query Results"),i.a.createElement(Oe.a,{variant:"body1",style:Lt.cardcardMarginLeftTop},"File Format"),i.a.createElement(yt.a,{component:"fieldset",required:!0},i.a.createElement(ft.a,{onChange:this.handleFileFormatChange,value:this.state.fileFormat,style:Lt.cardcardMarginLeftTop},i.a.createElement(ct.a,{label:"Delimited file (spreadsheet)",value:"delimited",control:i.a.createElement(gt.a,null)}),"delimited"===this.state.fileFormat&&i.a.createElement(ke.a,{required:!0,onChange:this.handleDelimiterChange,label:"Use , or \\t delimiter for sheet",value:this.state.delimiterChoice,disabled:"delimited"!==this.state.fileFormat,style:Lt.textField&&Lt.cardMarginLeft&&Lt.inlineTextField,id:"delimiterInput",type:"text",margin:"none",fullWidth:!0}),i.a.createElement(ct.a,{label:"JSON File",value:"json",control:i.a.createElement(gt.a,null)}),i.a.createElement(ct.a,{label:"XML File",value:"xml",control:i.a.createElement(gt.a,null)}),i.a.createElement(ct.a,{label:"FASTA File",value:"fasta",control:i.a.createElement(gt.a,null),style:null===this.identifySeqColumnInStateColumns()?Lt.hidden:null}),"fasta"===this.state.fileFormat&&i.a.createElement(Oe.a,{style:Lt.inlineTextField},"Note: FASTA header is composed from visible columns"),i.a.createElement(ct.a,{label:"Copy single column values",value:"delimitedColumn",control:i.a.createElement(gt.a,null)}))),"delimitedColumn"===this.state.fileFormat&&i.a.createElement("span",null,i.a.createElement(O.a,{style:Lt.inlineTextFieldSpan},i.a.createElement(x.a,{button:!0,onClick:this.handleClickListItem,"aria-haspopup":"true","aria-controls":"columnMenu","aria-label":"Choose column"},i.a.createElement(R.a,{primary:"Choose a column",secondary:this.state.columns[this.state.columnChosen]}))),i.a.createElement(U.a,{open:this.state.open,onClose:this.handleRequestClose,id:"columnMenu",anchorEl:this.state.anchorEl},this.state.columns.map((function(t,a){return i.a.createElement(K.a,{selected:a===e.state.columnChosen,onClick:function(t){return e.handleMenuItemClick(t,a)},key:t},t)}))),i.a.createElement(ct.a,{style:Lt.cardMarginLeft,control:i.a.createElement(ut.a,{color:"secondary",onChange:this.handleCopyUniqueValuesOnlyToggle,value:"copyUniqueValuesOnly"}),checked:this.state.copyUniqueValuesOnlyToggle,label:"Copy unique values only"})),i.a.createElement(Oe.a,{variant:"body1",style:Lt.cardcardMarginLeftTop},"Options"),i.a.createElement(vt.a,{style:Lt.cardcardMarginLeftTop},i.a.createElement(ct.a,{label:"Batch download",control:i.a.createElement(ut.a,{onChange:this.handlebatchDownloadCheckBox,value:"batchDownloadCheckBox"}),disabled:"delimitedColumn"===this.state.fileFormat,checked:this.state.batchDownloadCheckBox}),i.a.createElement("span",{style:!0!==this.state.batchDownloadCheckBox||"delimitedColumn"===this.state.fileFormat?Lt.hidden:Lt.inlineTextField1},i.a.createElement("div",{style:!1===isNaN(this.props.totalRows)&&this.props.totalRows>=0?Lt.hidden:null},i.a.createElement(Oe.a,{variant:"body2",style:Lt.inlineTextField1},'Re-run query with "Get exact row count" option selected')),i.a.createElement(i.a.Fragment,null,i.a.createElement(k.a,{onClick:this.handlebatchDownloadChange.bind(this,"10K"),color:"10K"===this.state.batchSize?"primary":"inherit",style:Lt.button},"10K"),i.a.createElement(k.a,{onClick:this.handlebatchDownloadChange.bind(this,"25K"),color:"25K"===this.state.batchSize?"primary":"inherit",style:Lt.button},"25K"),i.a.createElement(k.a,{onClick:this.handlebatchDownloadChange.bind(this,"100K"),color:"100K"===this.state.batchSize?"primary":"inherit",style:Lt.button},"100K"),i.a.createElement(k.a,{onClick:this.handlebatchDownloadChange.bind(this,"250K"),color:"250K"===this.state.batchSize?"primary":"inherit",style:Lt.button},"250K")),i.a.createElement("div",{style:Lt.inlineTextField},i.a.createElement(Oe.a,{variant:"body1",style:Lt.inlineTextField},String(this.state.batchDownloadLowerNum).replace(/\B(?=(\d{3})+(?!\d))/g,",")," ","to"," ",String(this.state.batchDownloadUpperNum).replace(/\B(?=(\d{3})+(?!\d))/g,",")," ","of"," ",String(this.props.totalRows).replace(/\B(?=(\d{3})+(?!\d))/g,",").replace("NaN","unknown")," ","rows")),i.a.createElement("div",{style:Lt.inlineTextField3},i.a.createElement(T.a,{onClick:this.handleLeftButtonClickRangeDownload,color:"primary",style:Lt.button,"aria-label":"COPY"},i.a.createElement(Et.a,null)),i.a.createElement(T.a,{onClick:this.handleRightButtonClickRangeDownload,color:"primary",style:Lt.button,"aria-label":"COPY"},i.a.createElement(kt.a,null)))),i.a.createElement(ct.a,{label:"Include table headers",control:i.a.createElement(ut.a,{onChange:this.handleTableHeaderToggle,disabled:"delimited"!==this.state.fileFormat,value:"tableHeader"}),checked:this.state.tableHeader})),i.a.createElement(vt.a,{style:Lt.cardcardMarginLeftTop&&Lt.cardcardMarginBottomRight},i.a.createElement(ke.a,{required:!0,disabled:"delimitedColumn"===this.state.fileFormat,id:"fileNameInput",type:"text",label:"File name",onChange:this.handleFileNameChange,value:""===this.state.fileNameCustom?this.state.fileNameAuto:this.state.fileNameCustom,style:Lt.textField&&Lt.cardMarginLeft,margin:"normal"})),this.state.copyLoading||this.state.submitLoading?i.a.createElement("img",{src:a(234),width:"100%",alt:"Progress indicator"}):i.a.createElement(C.a,null),i.a.createElement(k.a,{color:"primary",style:Lt.button,onClick:this.handleDownloadClick,disabled:"delimitedColumn"===this.state.fileFormat},"Download"),i.a.createElement(k.a,{color:"primary",disabled:"delimitedColumn"!==this.state.fileFormat&&"json"!==this.state.fileFormat&&"xml"!==this.state.fileFormat,style:Lt.button,onClick:this.handleCopyClick},"Copy"),i.a.createElement(k.a,{style:Lt.button&&Lt.floatRight,onClick:this.handleResetClick},"Reset")),i.a.createElement(D.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.snackBarVisibility,onClose:this.handleRequestClose,ContentProps:{"aria-describedby":"message-id"},message:i.a.createElement("span",{id:"message-id"},this.state.snackBarMessage),action:[i.a.createElement(T.a,{key:"close","aria-label":"Close",color:"secondary",style:Lt.close,onClick:this.handleRequestClose}," ",i.a.createElement(j.a,null)," ")]}))}}]),n}(n.Component),Lt={linearProgressClass:{height:2},inlineTextField:{marginLeft:34},inlineTextField1:{float:"none",margin:"0 auto"},inlineTextField2:{marginLeft:50},inlineTextField3:{marginLeft:135},button:{marginBottom:4},topMargin:{marginTop:16},cardMarginLeft:{marginLeft:32},cardMarginLeftRightTop:{marginLeft:16,marginTop:16,marginRight:6},cardcardMarginLeftTop:{marginLeft:16,paddingTop:16},inlineTextFieldSpan:{marginLeft:48,width:"275px"},cardcardMarginBottomRight:{marginRight:16,paddingBottom:16},cardMarginLeftTop:{marginTop:32},textField:{marginLeft:8,marginRight:8},textFieldCopyOutput:{marginLeft:32,marginRight:0,width:"70%"},hidden:{display:"none"},floatRight:{float:"right"}},Rt=a(322),Ft=a(42),Dt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).handleClose=function(){n.props.handleNewRowClick(!1)},n.handleReset=function(){clearTimeout(n.timer);var e=n.state.qbFilters;n.setState({qbFilters:[],inputVals:{},error:"",submitButtonLabel:"Submit"},(function(){n.setState({qbFilters:e})}))},n.handleInput=function(e,t,a){var i=e.target.value,r=n.state.inputVals||{};""===i?delete r[t]:(r[t]=r[t]||{},r[t].value=i,r[t].dataType=a),n.setState({inputVals:r})},n.handleSubmit=function(){if("Submit"===n.state.submitButtonLabel)n.setState({submitButtonLabel:"Are you sure?"}),n.timer=setTimeout((function(){n.setState({submitButtonLabel:"Submit"})}),4e3);else{clearTimeout(n.timer),n.setState({submitButtonLabel:"Submit"});for(var e=n.state.inputVals,t=Object.keys(n.state.inputVals),a=Ft.getDbConfig(n.props.dbIndex,"url")+"/"+n.state.table,i={},r=0;r<t.length;r++){var s=t[r],l=e[t[r]].value,o=e[t[r]].dataType,c=l;"string"===o?c=String(l):"integer"===o||"double"===o?c=Number(l):"boolean"===o&&(c=Boolean(l)),i[s]=c}var u={Prefer:"return=representation"};n.props.isLoggedIn&&n.props.token&&(u.Authorization="Bearer "+n.props.token),g.a.post(a,i,{headers:u}).then((function(e){n.commitToChangeLog(e.data),n.props.insertNewRow(e.data),n.handleReset(),n.props.handleNewRowClick(!1)})).catch((function(e){n.setState({error:e.response},(function(){document.getElementById("errorPaper").scrollIntoView()}))}))}},n.state={open:!1,table:e.table,columns:e.columns,allColumns:e.allColumns,primaryKeys:e.primaryKeys||[],qbFilters:e.qbFilters||[],url:e.url,inputVals:{},error:"",submitButtonLabel:"Submit"},n}return Object(o.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({open:e.open,table:e.table,columns:e.columns,allColumns:e.allColumns,primaryKeys:e.primaryKeys||[],qbFilters:e.qbFilters||[],url:e.url,inputVals:{},error:""})}},{key:"commitToChangeLog",value:function(e){for(var t={},a=0;a<this.state.primaryKeys.length;a++)t[this.state.primaryKeys[a]]=e[0][this.state.primaryKeys[a]];this.props.postReqToChangeLog(this.props.dbIndex,new Date(Date.now()).toISOString(),this.state.table,t,"ROW_INSERT","{}",e[0],"ROW INSERTED.","public")}},{key:"render",value:function(){var e=this,t=this.props.fullScreen,a=Ft.getTableConfig(this.props.dbIndex,this.state.table,"rename"),n=a||this.state.table;return i.a.createElement(i.a.Fragment,null,i.a.createElement(ge.a,{fullScreen:t,open:this.state.open,onClose:this.handleClose,"aria-labelledby":"responsive-dialog-title"},i.a.createElement(Ce.a,{id:"responsive-dialog-title"},"Insert new row to "+n),i.a.createElement(ye.a,null,""!==this.state.error&&i.a.createElement($e.a,{id:"errorPaper",style:Bt.paperError,elevation:4},i.a.createElement(Oe.a,{variant:"subtitle1",style:Bt.paperMarginTopLeft},"Request Denied"),i.a.createElement(ve.a,{style:Bt.paperMarginLeft},"Code: "+(this.state.error&&this.state.error.data?this.state.error.data.code:"")),i.a.createElement(ve.a,{style:Bt.paperMarginLeft},"Message: "+(this.state.error&&this.state.error.data?this.state.error.data.message:"")),i.a.createElement(ve.a,{style:Bt.paperMarginLeft},"Details: "+(this.state.error&&this.state.error.data?this.state.error.data.details:""))),i.a.createElement(ve.a,{style:Bt.paperMarginTop},"Unique values for the table's primary key ("+this.state.primaryKeys.join(", ")+") are mandatory (*). Other constraints may be imposed by the database schema, follow instructions in the error details."),i.a.createElement(Oe.a,{type:"subtitle1",style:Bt.cardMarginTopBottom},"New Row"),i.a.createElement(i.a.Fragment,null,this.state.qbFilters.map((function(t){return i.a.createElement(ke.a,{onChange:function(a){return e.handleInput(a,t.id,t.type)},key:t.id,label:t.label?t.label:t.id,required:e.state.primaryKeys.indexOf(t.id)>=0,placeholder:t.type,value:t.default_value||(e.state.inputVals[t.id]?e.state.inputVals[t.id].value:"")||"",style:Bt.textField,margin:"normal"})})))),i.a.createElement(C.a,null),i.a.createElement(fe.a,null,i.a.createElement(k.a,{onClick:this.handleClose},"Cancel"),i.a.createElement(k.a,{onClick:this.handleReset},"Reset"),i.a.createElement(k.a,{onClick:this.handleSubmit,color:"secondary",autoFocus:!0},this.state.submitButtonLabel))))}}]),a}(i.a.Component),Bt={paperMarginTopLeft:{paddingLeft:16,paddingTop:16,paddingBottom:8},paperMarginTop:{paddingLeft:16,paddingTop:16},paperMarginLeft:{paddingLeft:16,paddingBottom:8,paddingRight:8},cardMarginTopBottom:{marginBottom:8,marginTop:16},cardMarginLeft:{marginLeft:16},textField:{width:"60%"},paperError:{backgroundColor:"pink"}},It=Object(Rt.a)()(Dt),jt=a(315),Pt=a(313),Nt=a(314),qt=a(325),Mt=a(159),_t=a.n(Mt),At=a(160),Vt=a.n(At),Ht=a(161),Ut=a.n(Ht),Kt=a(158),zt=a.n(Kt),Jt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={table:e.table,columns:e.columns,url:e.url,dbPkInfo:{},primaryKeysAvailable:!1,primaryKeys:[],featureEnabled:!1|e.featureEnabled,changesMade:e.changesMade|{},rowsStrikedOut:e.rowsStrikedOut,snackBarVisibility:!1,snackBarMessage:"Unknown error occured",submitButtonLabel:"Submit",removeButtonLabel:"Remove All",newRowDialogOpen:!1},n.handleFeatureEnabledSwitch=n.handleFeatureEnabledSwitch.bind(Object(c.a)(n)),n.handleSubmitClick=n.handleSubmitClick.bind(Object(c.a)(n)),n.handleNewRowClick=n.handleNewRowClick.bind(Object(c.a)(n)),n.handleRemoveAllClick=n.handleRemoveAllClick.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"componentWillReceiveProps",value:function(e){if(this.setState({table:e.table,columns:e.columns,url:e.url,dbPkInfo:e.dbPkInfo,primaryKeys:[],primaryKeysAvailable:!1,changesMade:e.changesMade,rowsStrikedOut:e.rowsStrikedOut,featureEnabled:e.featureEnabled}),e.dbPkInfo&&this.state.table)for(var t=0;t<e.dbPkInfo.length;t++)e.dbPkInfo[t].table===this.state.table&&this.setState({primaryKeys:e.dbPkInfo[t].primary_keys,primaryKeysAvailable:"[]"!==JSON.stringify(e.dbPkInfo[t].primary_keys)})}},{key:"handleRemoveAllClick",value:function(e){var t=this;"Remove All"===this.state.removeButtonLabel?(this.setState({removeButtonLabel:"Are You Sure?"}),this.timer=setTimeout((function(){t.setState({removeButtonLabel:"Remove All"})}),4e3)):(clearTimeout(this.timer),this.setState({removeButtonLabel:"Remove All"}),this.props.deleteTableChanges())}},{key:"handleNewRowClick",value:function(e){!1===e||!0===e?this.setState({newRowDialogOpen:e}):this.setState({newRowDialogOpen:!this.state.newRowDialogOpen})}},{key:"handleSubmitClick",value:function(){var e=this;console.clear(),"Submit"===this.state.submitButtonLabel?(this.setState({submitButtonLabel:"Are you sure?"}),this.timer=setTimeout((function(){e.setState({submitButtonLabel:"Submit"})}),4e3)):(clearTimeout(this.timer),this.setState({submitButtonLabel:"Submit"}),this.props.submitChanges())}},{key:"handleFeatureEnabledSwitch",value:function(){var e=this;this.setState({featureEnabled:!this.state.featureEnabled},(function(){e.props.changeEditFeatureEnabled(e.state.featureEnabled)}))}},{key:"primaryKeyStringify",value:function(e){var t=Object.keys(e),a="";for(var n in Object.keys(e))a+=t[n]+" = "+e[t[n]],parseInt(n,10)!==t.length-1&&(a+=" and ");return a}},{key:"createChangeLogList",value:function(){if(""===this.state.table||"{}"===JSON.stringify(this.state.changesMade)||null===this.state.changesMade[this.state.table]||void 0===this.state.changesMade[this.state.table])return i.a.createElement(x.a,{key:-1},i.a.createElement(Pt.a,null,i.a.createElement(qt.a,null,i.a.createElement(De.a,null))),i.a.createElement(R.a,{primary:"No unsubmitted changes found..."}));for(var e=Object.keys(this.state.changesMade[this.state.table]).length,t=Object.keys(this.state.changesMade[this.state.table]),a=[],n=0;n<e;n++)for(var r=t[n],s=this.state.changesMade[this.state.table][r],l=Object.keys(s).length,o=0;o<l;o++){var c=s[Object.keys(s)[o]].oldValue,u=s[Object.keys(s)[o]].newValue,h=s[Object.keys(s)[o]].delete,d=s[Object.keys(s)[o]].primaryKey,m=s[Object.keys(s)[o]].error,p=s[Object.keys(s)[o]].errorResp;a.push(i.a.createElement("span",{key:String(n)+String(o)+"span"},i.a.createElement(x.a,{key:String(n)+String(o),title:m?p:""},i.a.createElement(Pt.a,null,m?i.a.createElement(qt.a,{style:Wt.errorAvatar},i.a.createElement(j.a,null)):h?i.a.createElement(qt.a,null," ",i.a.createElement(zt.a,null)," "):i.a.createElement(qt.a,null," ",i.a.createElement(_t.a,null)," ")),h?i.a.createElement(R.a,{primary:"Delete row",secondary:"Where "+this.primaryKeyStringify(d)}):i.a.createElement(R.a,{primary:r+" column changed",secondary:"From '"+c+"' to '"+u+"' where "+this.primaryKeyStringify(d)}),i.a.createElement(Nt.a,{onClick:this.props.deleteChange.bind(this,r,Object.keys(s)[o],h||!1)},i.a.createElement(T.a,{"aria-label":"Delete"},i.a.createElement(N.a,null)))),m&&p&&p.code&&p.message&&i.a.createElement(x.a,{key:String(n)+String(o)+"err"},i.a.createElement(R.a,{primary:"PostgreSQL Error Code: "+p.code,secondary:"Error: "+p.message}))))}return a}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement($e.a,{elevation:2,style:Wt.topMargin},i.a.createElement(Oe.a,{variant:"subtitle1",style:Wt.cardcardMarginLeftTop},"Edit Table Contents"),this.state.primaryKeysAvailable?i.a.createElement(vt.a,{style:Wt.cardMarginLeft},i.a.createElement(ct.a,{control:i.a.createElement(jt.a,{checked:this.state.featureEnabled,onChange:this.handleFeatureEnabledSwitch,value:"featureStatus"}),label:"Enable table edit feature"})):i.a.createElement(i.a.Fragment,null,i.a.createElement(O.a,{dense:!1},i.a.createElement(x.a,null,i.a.createElement(Pt.a,null,i.a.createElement(qt.a,{style:Wt.secondaryAvatar},i.a.createElement(Vt.a,null))),i.a.createElement(R.a,{primary:"This table cannot be edited because its primary keys were not found."})))),this.state.featureEnabled&&this.state.primaryKeysAvailable?i.a.createElement(i.a.Fragment,null,i.a.createElement(Oe.a,{variant:"body1",style:Wt.cardcardMarginLeftTop},"Changes made to this table"),i.a.createElement(O.a,{dense:!0},this.createChangeLogList())):"{}"!==JSON.stringify(this.state.changesMade)?i.a.createElement(i.a.Fragment,null,i.a.createElement(O.a,{dense:!1},i.a.createElement(x.a,null,i.a.createElement(Pt.a,null,i.a.createElement(qt.a,{style:Wt.amberAvatar},i.a.createElement(Ut.a,null))),i.a.createElement(R.a,{primary:"Unsubmitted changes are detected, these changes will be lost if not submitted."})))):i.a.createElement("div",null),i.a.createElement(C.a,null),i.a.createElement(k.a,{onClick:this.handleSubmitClick,disabled:!(this.state.featureEnabled&&this.state.primaryKeysAvailable),color:"primary",style:Wt.button,value:this.state.submitButtonLabel},this.state.submitButtonLabel),i.a.createElement(k.a,{onClick:this.handleNewRowClick,disabled:!(this.state.featureEnabled&&this.state.primaryKeysAvailable),color:"primary",style:Wt.button,value:"New Row"},"New Row"),i.a.createElement(k.a,{onClick:this.handleRemoveAllClick,disabled:!(this.state.featureEnabled&&this.state.primaryKeysAvailable),style:Wt.button&&Wt.floatRight,value:this.state.removeButtonLabel},this.state.removeButtonLabel)),i.a.createElement(It,Object.assign({},this.props,{open:this.state.newRowDialogOpen,primaryKeys:this.state.primaryKeys,handleNewRowClick:this.handleNewRowClick})),i.a.createElement(D.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.snackBarVisibility,onClose:this.handleRequestClose,ContentProps:{"aria-describedby":"message-id"},message:i.a.createElement("span",{id:"message-id"},this.state.snackBarMessage),action:[i.a.createElement(T.a,{key:"close","aria-label":"Close",color:"secondary",style:Wt.close,onClick:this.handleRequestClose}," ",i.a.createElement(j.a,null)," ")]}))}}]),a}(n.Component),Wt={button:{marginBottom:4},topMargin:{marginTop:16},cardMarginLeft:{marginLeft:32},cardcardMarginLeftTop:{marginLeft:16,paddingTop:16},floatRight:{float:"right"},secondaryAvatar:{color:"#fff",backgroundColor:He.a[500]},amberAvatar:{color:"#fff",backgroundColor:E.a[500]},errorAvatar:{color:"#fff",backgroundColor:tt.a[500]}},Qt=(a(235),a(162)),$t=a.n(Qt)()(pt.a),Gt=a(42),Xt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).toggleAll=function(){if(n.state.editFeatureChangesMade&&n.state.editFeatureChangesMade[n.state.table]&&n.state.editFeatureChangesMade[n.state.table].id)for(var e=Object.keys(n.state.editFeatureChangesMade[n.state.table].id),t=e.length,a=0;a<t;a++)n.deleteChange("id",e[a],!0)},n.toggleSelection=function(e,t,a){for(var i={},r=e.join(""),s=0;s<n.state.tablePrimaryKeys.length;s++)i[n.state.tablePrimaryKeys[s]]=e[s];var l=n.state.editFeatureChangesMade;l[n.state.table]=l[n.state.table]||{},l[n.state.table].id=l[n.state.table].id||{},l[n.state.table].id[r]=l[n.state.table].id[r]||{},l[n.state.table].id[r].delete?n.deleteChange("id",r,!0):(l[n.state.table].id[r].primaryKey=i,l[n.state.table].id[r].delete=!l[n.state.table].id[r].delete),n.setState({editFeatureChangesMade:l})},n.isSelected=function(e){return n.state.editFeatureChangesMade!=={}&&void 0!==n.state.editFeatureChangesMade[n.state.table]&&void 0!==n.state.editFeatureChangesMade[n.state.table].id&&Object.keys(n.state.editFeatureChangesMade[n.state.table].id).includes(e.join(""))},n.handleRequestClose=function(){n.setState({snackBarVisibility:!1})},n.state={table:e.table,columns:e.columns,data:[],url:e.url,dbPrimaryKeys:[],tablePrimaryKeys:[],editFeatureEnabled:!1,editFeatureChangesMade:{},rowsStrikedOut:[]},n.renderEditableCell=n.renderEditableCell.bind(Object(c.a)(n)),n.submitChanges=n.submitChanges.bind(Object(c.a)(n)),n.deleteChange=n.deleteChange.bind(Object(c.a)(n)),n.deleteTableChanges=n.deleteTableChanges.bind(Object(c.a)(n)),n.postReqToChangeLog=n.postReqToChangeLog.bind(Object(c.a)(n)),n.changeEditFeatureEnabled=n.changeEditFeatureEnabled.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"componentWillReceiveProps",value:function(e){if(this.setState({table:e.table,columns:e.columns,url:e.url,data:this.addPkAsId(e.data),tablePrimaryKeys:[],editFeatureEnabled:this.state.table===e.table&&this.state.editFeatureEnabled}),e.dbPkInfo&&this.state.table)for(var t=0;t<e.dbPkInfo.length;t++)e.dbPkInfo[t].table===this.state.table&&this.setState({tablePrimaryKeys:e.dbPkInfo[t].primary_keys})}},{key:"addPkAsId",value:function(e){var t=this;return e?e.map((function(e){for(var a=[],n=0;n<t.state.tablePrimaryKeys.length;n++)a.push(e[t.state.tablePrimaryKeys[n]]);var i=a;return Object(v.a)({_id:i},e)})):[]}},{key:"changeEditFeatureEnabled",value:function(e){this.setState({editFeatureEnabled:e})}},{key:"changeEditFeatureChangesMade",value:function(e){this.setState({editFeatureChangesMade:e})}},{key:"deleteTableChanges",value:function(){var e=this.state.editFeatureChangesMade[this.state.table];if(e)for(var t=Object.keys(e),a=t.length,n=0;n<a;n++)for(var i=t[n],r=Object.keys(e[i]),s=r.length,l=0;l<s;l++){var o=r[l];this.deleteChange(i,o,!1)}}},{key:"deleteChange",value:function(e,t,a){var n=this.state.editFeatureChangesMade;if(!1===a){var i=n[this.state.table][e][t].oldValue;if(i){var r=this.state.data;r[n[this.state.table][e][t].rowIndex][e]=i,this.setState({data:r})}}if("id"===e&&t&&"delete"===a){for(var s=this.state.data.length,l=null,o=0;o<s;o++)if(this.state.data[o]._id.join("")===t){l=o;break}var c=this.state.data;c.splice(l,1),this.setState({data:c})}delete n[this.state.table][e][t],"{}"===JSON.stringify(n[this.state.table][e])&&delete n[this.state.table][e],"{}"===JSON.stringify(n[this.state.table])&&delete n[this.state.table],this.setState({editFeatureChangesMade:n})}},{key:"setChangeError",value:function(e,t,a,n){var i=this.state.editFeatureChangesMade;i[this.state.table][e][t].error=a||!0,i[this.state.table][e][t].errorResp=n,this.setState({editFeatureChangesMade:i})}},{key:"primaryKeyAsUrlParam",value:function(e){var t=Object.keys(e),a="";for(var n in Object.keys(e))a+=t[n]+".eq."+e[t[n]],parseInt(n,10)!==t.length-1&&(a+=",");return a}},{key:"postReqToChangeLog",value:function(e,t,a,n,i,r,s,l,o){var c=this,u=Gt.getDbConfig(e,"url")+"/change_log",h={};h.change_timestamp=t,h.table_changed=a,h.primary_key_of_changed_row=JSON.stringify(n),h.column_changed=i,h.old_value=String(r)||"error",h.new_value=String(s)||"error",h.notes=l,h.user_name=o;var d={Prefer:"return=representation"};this.props.isLoggedIn&&this.props.token&&(d.Authorization="Bearer "+this.props.token),g.a.post(u,h,{headers:d}).then((function(e){})).catch((function(e){c.setState({snackBarVisibility:!0,snackBarMessage:"Error committing CHANGE LOG!"},(function(){c.timer=setTimeout((function(){c.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),5e3)}))}))}},{key:"submitChanges",value:function(){var e=this,t=this.state.editFeatureChangesMade[this.state.table];if(null!==t&&void 0!==t)for(var a=0;a<Object.keys(t).length;a++)for(var n=t[Object.keys(t)[a]],i=function(i){var r=t[Object.keys(t)[a]][Object.keys(n)[i]],s=r.primaryKey,l=Object.keys(t)[a],o=Object.keys(n)[i],c=r.oldValue,u=r.newValue,h=r.delete;if(!0!==h&&String(c)!==String(u)){var d=Gt.getDbConfig(e.props.dbIndex,"url")+"/"+e.state.table+"?and=("+e.primaryKeyAsUrlParam(s)+")",m={Prefer:"return=representation"};e.props.isLoggedIn&&e.props.token&&(m.Authorization="Bearer "+e.props.token),g.a.patch(d,Object(W.a)({},l,u),{headers:m}).then((function(t){e.deleteChange(l,o,!0),e.postReqToChangeLog(e.props.dbIndex,new Date(Date.now()).toISOString(),e.state.table,s,l,c,u,"",e.props.userName||"Unknown Username")})).catch((function(t){console.error("PATCH ERROR RESP:"+String(t)),e.setChangeError(l,o,!0,t.response.data),e.setState({snackBarVisibility:!0,snackBarMessage:"Database update failed."},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),5e3)}))}))}else if(h){var p=Gt.getDbConfig(e.props.dbIndex,"url")+"/"+e.state.table+"?and=("+e.primaryKeyAsUrlParam(s)+")",b={Prefer:"return=representation"};e.props.isLoggedIn&&e.props.token&&(b.Authorization="Bearer "+e.props.token),g.a.delete(p,{headers:b}).then((function(t){for(var a=null,n=[],i=0;i<e.state.tablePrimaryKeys.length;i++)n.push(s[e.state.tablePrimaryKeys[i]]);for(var r=0;r<e.state.data.length;r++)String(e.state.data[r]._id)===String(n)&&(a=JSON.stringify(e.state.data[r]));e.postReqToChangeLog(e.props.dbIndex,new Date(Date.now()).toISOString(),e.state.table,s,"ROW_DELETE",a||"Error finding old row...","{}","ROW DELETED.",e.props.userName||"Unknown Username"),e.deleteChange("id",o,"delete")})).catch((function(t){console.error("ERROR RESP: "+String(t)),e.setChangeError("id",o,!0,t.response.data),e.setState({snackBarVisibility:!0,snackBarMessage:"Row delete request failed."},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),5e3)}))}))}else console.error("Tell user that the change was not actually detected... and that they should submit a bug"),e.setState({snackBarVisibility:!0,snackBarMessage:"Change was not detected."},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),2500)}))},r=0;r<Object.keys(n).length;r++)i(r)}},{key:"renderEditableCell",value:function(e){var t=this;return i.a.createElement("div",{style:{backgroundColor:"#fafafa",border:"none",borderBottom:"1px solid lightpink",padding:"1px"},contentEditable:!0,suppressContentEditableWarning:!0,onBlur:function(a){var n=Object(mt.a)(t.state.data),i=e.index,r=e.column.id,s=n[i][r],l=a.target.innerHTML;if(""===String(l)?l=null:"string"===typeof s?l=String(l):"number"===typeof s?l=Number(l):"boolean"===typeof s&&(l=Boolean(l)),String(s)!==String(l)&&("null"!==String(s)||""!==String(l))&&String(l).indexOf("<br>")<0&&String(l).indexOf("<div>")<0){for(var o={},c="",u=0;u<t.state.tablePrimaryKeys.length;u++)o[t.state.tablePrimaryKeys[u]]=n[i][t.state.tablePrimaryKeys[u]],c+=String(n[i][t.state.tablePrimaryKeys[u]]);n[i][r]=l;var h=t.state.editFeatureChangesMade;h[t.state.table]=h[t.state.table]||{},h[t.state.table][r]=h[t.state.table][r]||{},h[t.state.table][r][c]=h[t.state.table][r][c]||{},h[t.state.table][r][c].oldValue=h[t.state.table][r][c].oldValue||s,h[t.state.table][r][c].newValue=l,h[t.state.table][r][c].primaryKey=o,h[t.state.table][r][c].rowIndex=i,String(h[t.state.table][r][c].oldValue)===String(l)&&t.deleteChange(r,c,!0),t.setState({data:n,editFeatureChangesMade:h})}},dangerouslySetInnerHTML:{__html:this.state.data[e.index][e.column.id]}})}},{key:"render",value:function(){var e=this,t=this.state,a=t.columns,n=t.data,r=Object(mt.a)(n||[]).map((function(e){var t={};return Object.entries(e).forEach((function(e){var a=Object(dt.a)(e,2),n=a[0],i=a[1],r=i;if(("object"===typeof i||!Array.isArray(i))&&null!==i)try{r=JSON.stringify(i)}catch(s){}t[n]=r})),t})),s=[];a&&(s=a.map((function(t){var a=Gt.getColumnConfig(e.props.dbIndex,e.state.table,t,"rename"),n=Gt.getColumnConfig(e.props.dbIndex,e.state.table,t,"visible"),i=Gt.getColumnConfig(e.props.dbIndex,e.state.table,t,"editable"),r=Gt.getTableConfig(e.props.dbIndex,e.state.table,"defaultWidthPx"),s=Gt.getColumnConfig(e.props.dbIndex,e.state.table,t,"widthPx"),l=Gt.getColumnConfig(e.props.dbIndex,e.state.table,t,"minWidthPx"),o=Gt.getColumnConfig(e.props.dbIndex,e.state.table,t,"maxWidthPx");return{id:t,Header:a||t,accessor:t,show:null===n||n,width:null!==s?s:r||void 0,maxWidth:null!==o?o:void 0,minWidth:null!==l?l:100,headerStyle:{fontWeight:"bold"},Cell:!0===e.state.editFeatureEnabled&&!1!==i?e.renderEditableCell:function(e){return void 0!==e.value&&null!==e.value?String(e.value):e.value}}})));var l=this.toggleSelection,o={isSelected:this.isSelected,toggleSelection:l,toggleAll:this.toggleAll,selectType:"checkbox",getTrProps:function(t,a){var n=!1;try{n=e.isSelected(a.original._id)}catch(i){n=!1}return{style:{backgroundColor:n?"lightpink":"inherit",textDecoration:n?"line-through":"none"}}}};return i.a.createElement(i.a.Fragment,null,this.state.editFeatureEnabled?i.a.createElement($t,Object.assign({data:n,columns:s,defaultPageSize:10,className:"-striped -highlight",pageSizeOptions:[10,50,100,200,500,1e3],previousText:"Previous Page",nextText:"Next Page",noDataText:this.props.noDataText},o)):i.a.createElement(pt.a,{data:r,columns:s,defaultPageSize:10,className:"-striped -highlight",pageSizeOptions:[10,50,100,200,500,1e3],previousText:"Previous Page",nextText:"Next Page",noDataText:this.props.noDataText}),i.a.createElement("div",{style:Yt.cardGroups},i.a.createElement(ht.a,{container:!0,spacing:10,direction:""===this.state.tablePrimaryKeys.join(",")?"row-reverse":"row"},""!==this.state.tablePrimaryKeys.join(",")&&i.a.createElement(ht.a,{item:!0,sm:12,md:6},i.a.createElement(Jt,Object.assign({},this.props,{table:this.state.table,columns:this.state.columns,url:this.state.url,featureEnabled:this.state.editFeatureEnabled,changesMade:this.state.editFeatureChangesMade,rowsStrikedOut:this.state.rowsStrikedOut,submitChanges:this.submitChanges,deleteChange:this.deleteChange,deleteTableChanges:this.deleteTableChanges,postReqToChangeLog:this.postReqToChangeLog,changeEditFeatureEnabled:this.changeEditFeatureEnabled}))),i.a.createElement(ht.a,{item:!0,sm:12,md:6},i.a.createElement(xt,Object.assign({},this.props,{table:this.state.table,columns:this.state.columns,data:this.state.data,url:this.state.url}))))),i.a.createElement(D.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.snackBarVisibility,onClose:this.handleRequestClose,ContentProps:{"aria-describedby":"message-id"},message:i.a.createElement("span",{id:"message-id"},this.state.snackBarMessage),action:[i.a.createElement(T.a,{key:"close","aria-label":"Close",color:"secondary",style:Yt.close,onClick:this.handleRequestClose}," ",i.a.createElement(j.a,null)," ")]}))}}]),a}(n.Component),Yt={root:{width:"29%",height:"100%",float:"left"},headerClass:{fontWeight:"bold"},button:{margin:5,float:"right"},topMargin:{margin:5,marginTop:25},cardGroups:{flexGrow:1}},Zt=a(92),ea=a.n(Zt),ta=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={rows:e.rows?e.rows:0,totalRows:e.totalRows?e.totalRows:0,rowLimit:e.rowLimit?e.rowLimit:2500,maxRows:e.maxRows?e.maxRows:25e4,tip:"Tip: Hold shift and click to multi-sort!",tip2:"Increase row-limit for full result.",title2:"",tip3:"Use Batch Download option.",isTip1FdpOpen:!1,isTip2FdpOpen:!1,isTip3FdpOpen:!1},n}return Object(o.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({rows:e.rows?e.rows:0,totalRows:e.totalRows?e.totalRows:0,rowLimit:e.rowLimit?e.rowLimit:2500,maxRows:e.maxRows?e.maxRows:1e5})}},{key:"render",value:function(){var e=this,t="Displaying "+String(this.props.rows||0).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" rows";return this.props.totalRows>=0&&(t="Displaying "+String(this.props.rows||0).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" of "+String(this.props.totalRows||0).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" rows"),i.a.createElement("div",{style:aa.row},i.a.createElement(Ae,{onClose:function(){return e.setState({isTip1FdpOpen:!1})},open:this.state.isTip1FdpOpen,backgroundColor:ea.a[600],title:"Rows in Data Table",subtractFromTopPos:60,opacity:.95,description:"Keep track of rows count to ensure full query result is displayed. Increase 'Row-limit' and enable 'Get exact row count' option to ensure full result."},i.a.createElement($.a,{color:"secondary",variant:"outlined",label:t,onMouseEnter:function(){e.timer=setTimeout((function(){e.setState({isTip1FdpOpen:!0})}),250)},onMouseLeave:function(){e.setState({isTip1FdpOpen:!1}),clearTimeout(e.timer)},key:1,style:aa.chip})),this.state.rows===this.state.rowLimit&&this.state.rows!==this.state.maxRows?i.a.createElement(Ae,{onClose:function(){return e.setState({isTip2FdpOpen:!1})},open:this.state.isTip2FdpOpen,backgroundColor:ea.a[600],title:"Increase Row-limit",subtractFromTopPos:75,opacity:.95,description:"A higher row-limit can show more rows of the query result."},i.a.createElement($.a,{label:this.state.tip2,key:3,style:aa.chip,onClick:function(){e.props.increaseRowLimit(e.state.maxRows)},onMouseEnter:function(){e.timer=setTimeout((function(){e.setState({isTip2FdpOpen:!0})}),250)},onMouseLeave:function(){e.setState({isTip2FdpOpen:!1}),clearTimeout(e.timer)}})):i.a.createElement("div",null),this.state.rows===this.state.maxRows?i.a.createElement(Ae,{onClose:function(){return e.setState({isTip3FdpOpen:!1})},open:this.state.isTip3FdpOpen,backgroundColor:ea.a[600],title:"Batch Download Option",subtractFromTopPos:75,opacity:.95,description:"Can download data in batches when the full query result contains more than 2.5 million rows."},i.a.createElement($.a,{label:this.state.tip3,key:2,color:"secondary",variant:"outlined",style:aa.chip,onMouseEnter:function(){e.timer=setTimeout((function(){e.setState({isTip3FdpOpen:!0})}),250)},onMouseLeave:function(){e.setState({isTip3FdpOpen:!1}),clearTimeout(e.timer)}})):i.a.createElement("div",null),i.a.createElement($.a,{label:this.state.tip,key:4,style:aa.chip}))}}]),a}(n.Component),aa={chip:{margin:5},row:{display:"flex",justifyContent:"flex-end",flexWrap:"wrap",marginTop:-30,marginRight:"1%"}},na=(a(236),a(42)),ia=na.getQBRules();Qe()(g.a,{debug:!1});var ra=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).insertNewRow=function(e){var t=n.state.rawData;t.splice(0,0,e[0]),n.setState({rawData:t})},n.handleSubmitButtonClick=function(e){clearTimeout(n.timer),n.timer=null,n.setState({rawData:[],rows:0,submitLoading:!0,submitError:!1,submitSuccess:!1},(function(){var t=null;try{t=window.$(n.refs.queryBuilder).queryBuilder("getRules")}catch(e){console.error(e.toString())}return n.setState({rules:t},(function(){var e=n.buildURLFromRules(t);n.fetchOutput(e),n.setState({url:e})})),t}))},n.increaseRowLimit=function(){var e={target:{}};e.target.value=25e4,n.handleRowLimitChange(e)},n.handleRequestClose=function(){n.setState({snackBarVisibility:!1})},n.state={table:e.table,columns:e.columns,visibleColumns:e.visibleColumns,leftPaneVisibility:e.leftPaneVisibility,rules:null,rulesFromHistoryPane:null,submitLoading:!1,submitError:!1,submitSuccess:!1,rows:null,exactRowCount:n.props.exactCount||!1,snackBarVisibility:!1,snackBarMessage:"Unknown error occured",rowLimit:Math.min(n.props.rowLimit,25e4)||25e3,url:""},n.handleRowLimitChange=n.handleRowLimitChange.bind(Object(c.a)(n)),n.handleGetExactRowCountToggle=n.handleGetExactRowCountToggle.bind(Object(c.a)(n)),n.handleSubmitButtonClickCancelQuery=n.handleSubmitButtonClickCancelQuery.bind(Object(c.a)(n)),n.handleSubmitButtonClick=n.handleSubmitButtonClick.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(clearTimeout(this.timer),this.timer=null,null!==e.rulesFromHistoryPane&&void 0!==e.rulesFromHistoryPane){var a=na.getQBFilters(this.props.dbIndex,this.state.table,this.state.columns,this.state.dbSchemaDefinitions),n=e.rulesFromHistoryPane;this.setState({rulesFromHistoryPane:n}),this.checkIfRulesColumnsAreInStateTableColumns(n)?(window.$(this.refs.queryBuilder).queryBuilder("destroy"),window.$(this.refs.queryBuilder).queryBuilder({filters:a,rules:n,plugins:["not-group"]}),this.props.changeRules(null)):(window.$(this.refs.queryBuilder).queryBuilder.constructor.DEFAULTS.operators=na.getQBOperators(),window.$(this.refs.queryBuilder).queryBuilder.constructor.DEFAULTS.lang=na.getQBLang(),window.$(this.refs.queryBuilder).queryBuilder("destroy"),window.$(this.refs.queryBuilder).queryBuilder({filters:a,defaultRules:ia,plugins:["not-group"]}))}else this.setState({rulesFromHistoryPane:null});void 0!==e.visibleColumns&&this.props.dbIndex===e.dbIndex&&this.state.table===e.table&&this.state.columns===e.columns&&this.state.leftPaneVisibility===e.leftPaneVisibility?this.setState({visibleColumns:e.visibleColumns}):this.state.leftPaneVisibility!==e.leftPaneVisibility?this.setState({leftPaneVisibility:e.leftPaneVisibility}):this.props.dbIndex!==e.dbIndex?this.setState({dbSchemaDefinitions:e.dbSchemaDefinitions,table:"",columns:[],visibleColumns:[],leftPaneVisibility:!0,rules:null,submitLoading:!0,submitError:!1,submitSuccess:!1,rawData:[],rows:null},(function(){t.rebuildQueryBuilder(t.refs.queryBuilder,e.dbIndex,e.table,e.columns);var a=na.getDbConfig(t.props.dbIndex,"url")+"/"+t.state.table;t.setState({url:a+"?limit=10"}),""!==t.state.table&&t.fetchOutput(a+"?limit=10",!0)})):this.setState({dbSchemaDefinitions:e.dbSchemaDefinitions,table:e.table,columns:e.columns,visibleColumns:e.visibleColumns,leftPaneVisibility:e.leftPaneVisibility,rules:null,submitLoading:!1,submitError:!1,submitSuccess:!1,rawData:[],rows:null},(function(){t.rebuildQueryBuilder(t.refs.queryBuilder,e.dbIndex,e.table,e.columns,e.dbSchemaDefinitions);var a=na.getDbConfig(t.props.dbIndex,"url")+"/"+t.state.table;t.setState({url:a+"?limit=10"}),""!==t.state.table&&t.fetchOutput(a+"?limit=10",!0)}))}},{key:"componentDidMount",value:function(){var e=this.refs.queryBuilder;this.initializeQueryBuilder(e)}},{key:"componentWillUnmount",value:function(){window.$(this.refs.queryBuilder).queryBuilder("destroy"),g.a.cancel("qbAxiosReq"),g.a.cancelAll()}},{key:"initializeQueryBuilder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{window.$(this.refs.queryBuilder).queryBuilder.constructor.DEFAULTS.operators=na.getQBOperators(),window.$(this.refs.queryBuilder).queryBuilder.constructor.DEFAULTS.lang=na.getQBLang();var a=na.getQBFilters(this.props.dbIndex,this.state.table,this.state.columns,this.state.dbSchemaDefinitions),n=t||ia;window.$(e).queryBuilder({filters:a,rules:n,plugins:["not-group"]})}catch(i){console.error(i)}}},{key:"rebuildQueryBuilder",value:function(e,t,a,n,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.state.rulesFromHistoryPane;window.$(this.refs.queryBuilder).queryBuilder("destroy"),window.$(this.refs.queryBuilder).queryBuilder.constructor.DEFAULTS.operators=na.getQBOperators(),window.$(this.refs.queryBuilder).queryBuilder.constructor.DEFAULTS.lang=na.getQBLang();var s=r||ia,l=na.getQBFilters(t,a,n,i);this.setState({qbFilters:l}),null!==r&&void 0!==r&&this.checkIfRulesColumnsAreInStateTableColumns(s)?(window.$(e).queryBuilder({filters:l,rules:s,plugins:["not-group"]}),this.props.changeRules(null)):window.$(e).queryBuilder({filters:l,defaultRules:ia,plugins:["not-group"]})}},{key:"recursiveColumnNameExtraction",value:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a].field;if(null!==n&&void 0!==n)t.push(n);else if("AND"===e[a].condition||"OR"===e[a].condition)for(var i=this.recursiveColumnNameExtraction(e[a].rules),r=0;r<i.length;r++)null!==i[r]&&void 0!==i[r]&&t.push(i[r])}return t}},{key:"checkIfRulesColumnsAreInStateTableColumns",value:function(e){for(var t=na.arrNoDup(this.recursiveColumnNameExtraction(e.rules)),a=!0,n=0;n<t.length;n++)!1===na.inArray(t[n],this.state.columns)&&(a=!1);return a}},{key:"recursiveRulesExtraction",value:function(e,t,a){for(var n=e+t.toLowerCase()+"(",i=0;i<a.length;i++){var r=!0===a[i].not?"not.":"";if("OR"===a[i].condition||"AND"===a[i].condition)i===a.length-1?n+=this.recursiveRulesExtraction(r,a[i].condition,a[i].rules):n+=this.recursiveRulesExtraction(r,a[i].condition,a[i].rules)+",";else{var s="contains"===a[i].operator&&-1===a[i].value.indexOf("*")?"*":"",l="in"===a[i].operator?"(":"",o="in"===a[i].operator?")":"",c="";if("contains"===a[i].operator||"equal"===a[i].operator||"not_equal"===a[i].operator){c=/\W/g.test(a[i].value)?'"':""}i===a.length-1?n+=a[i].id+"."+na.translateOperatorToPostgrest(a[i].operator)+"."+c+s+l+a[i].value+o+s+c:n+=a[i].id+"."+na.translateOperatorToPostgrest(a[i].operator)+"."+c+s+l+a[i].value+o+s+c+","}}return n+=")"}},{key:"buildURLFromRules",value:function(e){var t=this,a=na.getDbConfig(this.props.dbIndex,"url")+"/"+this.state.table;if(e&&e.valid&&!0===e.valid){a+="?";var n="";!0===e.not&&(n="not.");var i=e.condition,r=e.rules;a+=this.recursiveRulesExtraction(n,i+"=",r),a+="&limit="+this.state.rowLimit}else a+="?limit="+this.state.rowLimit,this.setState({snackBarVisibility:!0,snackBarMessage:"Incomplete query"},(function(){t.timer=setTimeout((function(){t.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),2500)}));return this.props.addToHistory(a,e),a}},{key:"fetchOutput",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];clearTimeout(this.timer),this.timer=null;var n={};!0===this.state.exactRowCount&&!1===a?n.Prefer="count=exact":n.Prefer="count=estimated",this.props.isLoggedIn&&this.props.token&&(n.Authorization="Bearer "+this.props.token),g.a.get(e,{headers:n,requestId:"qbAxiosReq"}).then((function(e){var a=null,n=null;void 0!==e.headers["content-range"]&&null!==e.headers["content-range"]&&(a=1+parseInt(e.headers["content-range"].replace("/*","").replace("0-",""),10),n=parseInt(e.headers["content-range"].replace(/0-\d*\//,""),10)),t.setState({rawData:e.data,rows:a,totalRows:n,submitLoading:!1,submitError:!1,submitSuccess:!0},(function(){t.timer=setTimeout((function(){t.setState({submitLoading:!1,submitSuccess:!1,submitError:!1})}),2e3)}))})).catch((function(e){console.error("HTTP Req:",e),t.setState({rawData:[],rows:null,submitLoading:!1,submitSuccess:!0,submitError:!0},(function(){t.timer=setTimeout((function(){t.setState({submitLoading:!1,submitSuccess:!1,submitError:!1})}),2e3)}))}))}},{key:"handleSubmitButtonClickCancelQuery",value:function(){g.a.cancel("qbAxiosReq"),g.a.cancelAll()}},{key:"handleRowLimitChange",value:function(e){var t=e.target.value;t<=0?t=1:t>25e4&&(t=25e4),this.setState({rowLimit:parseInt(t,10)})}},{key:"handleGetExactRowCountToggle",value:function(){this.setState({exactRowCount:!this.state.exactRowCount})}},{key:"handleCopyUrlToClipboard",value:function(){var e=this,t=this.state.url;document.oncopy=function(e){e&&e.clipboardData&&(e.clipboardData.setData("Text",t),e.preventDefault())};var a=document.execCommand("Copy");return document.oncopy=null,this.setState({snackBarVisibility:!0,snackBarMessage:"Link copied!"},(function(){e.timer=setTimeout((function(){e.setState({snackBarVisibility:!1,snackBarMessage:"Unknown error"})}),2500)})),a}},{key:"render",value:function(){var e,t=na.getTableConfig(this.props.dbIndex,this.state.table,"rename"),a=t||this.state.table,n=na.getTableConfig(this.props.dbIndex,this.props.table,"description")?na.getTableConfig(this.props.dbIndex,this.props.table,"description"):"",r=this.state.table?"":sa.hide,s=!0===this.state.leftPaneVisibility?sa.root:Object(v.a)(Object(v.a)({},sa.root),sa.rootInvisibleLeft),l=Object(v.a)(Object(v.a)({},r),s);return i.a.createElement("div",{style:sa.middlePaperSection},i.a.createElement($e.a,{style:l,elevation:5},i.a.createElement(Ge.a,{title:a,subheader:n}),i.a.createElement(Oe.a,{type:"subtitle1",style:sa.cardMarginLeftTop},"Query Builder"),i.a.createElement("div",{id:"query-builder",ref:"queryBuilder"}),i.a.createElement($e.a,{className:"query-builder",elevation:1},i.a.createElement(B.a,{id:"tooltip-bottom",title:"Copy query link",placement:"bottom"},i.a.createElement(L.a,{style:{margin:"16px"},onClick:this.handleCopyUrlToClipboard.bind(this)},i.a.createElement(M.a,null))),i.a.createElement("div",{style:{textAlign:"center",padding:"16px",overflow:"auto"}},null===(e=this.state)||void 0===e?void 0:e.url)),i.a.createElement(Oe.a,{type:"body1",style:sa.cardMarginLeftTop},"Options"),i.a.createElement(ht.a,{container:!0,spacing:10,alignItems:"center"},i.a.createElement(ht.a,{item:!0,sm:10,md:5},i.a.createElement(B.a,{id:"tooltip-bottom",title:"Max limit is 250,000 rows. Use Batch Download option for more.",placement:"bottom"},i.a.createElement(ke.a,{required:!0,id:"rowLimit",type:"number",label:"Row-limit",value:this.state.rowLimit.toString(),style:sa.rowLimitTextField,margin:"normal",onChange:this.handleRowLimitChange}))),i.a.createElement(ht.a,{item:!0,sm:10,md:5},i.a.createElement(ct.a,{style:sa.cardMarginLeft,control:i.a.createElement(ut.a,{color:"primary",onChange:this.handleGetExactRowCountToggle,value:"getExactRowCount"}),checked:this.state.exactRowCount,label:"Get exact row count"})),i.a.createElement(ht.a,{item:!0,sm:2,md:2},i.a.createElement("div",{title:"Run Query",onClick:this.handleSubmitButtonClickCancelQuery},i.a.createElement(lt,{dbIndex:this.props.dbIndex,table:this.state.table,leftPaneVisibility:this.state.leftPaneVisibility,getRules:this.handleSubmitButtonClick,loading:this.state.submitLoading,success:this.state.submitSuccess,error:this.state.submitError})))),i.a.createElement(Oe.a,{type:"subtitle1",style:sa.cardMarginLeftTop},"Query Results"),i.a.createElement(ta,{rows:this.state.rows,totalRows:this.state.totalRows,rowLimit:this.state.rowLimit,maxRows:25e4,increaseRowLimit:this.increaseRowLimit}),i.a.createElement("div",{style:sa.cardMarginLeftRightTop},i.a.createElement(Xt,Object.assign({},this.props,{table:this.state.table,columns:this.state.visibleColumns?this.state.visibleColumns:this.state.columns,allColumns:this.state.columns,data:this.state.rawData,qbFilters:this.state.qbFilters,url:this.state.url,totalRows:this.state.totalRows,insertNewRow:this.insertNewRow,noDataText:this.state.submitLoading?"Loading ...":this.state.submitError?"Query error":this.state.submitSuccess?"Success!":"No rows found"})))),i.a.createElement(D.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:this.state.snackBarVisibility,onClose:this.handleRequestClose,ContentProps:{"aria-describedby":"message-id"},message:i.a.createElement("span",{id:"message-id"},this.state.snackBarMessage),action:[i.a.createElement(T.a,{key:"close","aria-label":"Close",color:"secondary",style:sa.close,onClick:this.handleRequestClose}," ",i.a.createElement(j.a,null)," ")]}))}}]),a}(n.Component),sa={root:{paddingBottom:50,marginLeft:"30%",marginBottom:"2%",transition:"all 0.25s"},rootInvisibleLeft:{paddingBottom:50,marginLeft:"1%"},middlePaperSection:{width:"99%",height:"100%",marginTop:75},cardMarginLeft:{marginLeft:32},cardMarginLeftRightTop:{marginLeft:16,marginTop:16,marginRight:6},cardMarginLeftTop:{marginLeft:16,marginTop:32},rowLimitTextField:{marginLeft:32,marginRight:5,width:300},hide:{opacity:0,marginTop:75,visibility:"hidden"},noStyleButton:{border:"none",fill:E.a[700]}},la=a(42),oa=null,ca=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).handleLogoutClick=function(){oa&&oa.logout(),n.setState({token:null,userName:"Unknown username",isLoggedIn:!1})};var i=n.parseURL();return n.state={dbIndex:i.db||0,table:i.table||"",rowLimit:i.rowLimit||10,exactCount:i.exactCount||!1,rulesFromURL:i.urlRules||null,rulesFromHistoryPane:null,columns:[],newHistoryItem:[],visibleColumns:[],leftPaneVisibility:!0,historyPaneVisibility:!1,searchTerm:"",dbSchemaDefinitions:null,dbPkInfo:null,userName:"Unknown username",token:null,isLoggedIn:!1},oa=new y(i.db||0),n.setUserEmailPassword=n.setUserEmailPassword.bind(Object(c.a)(n)),n.toggleLeftPane=n.toggleLeftPane.bind(Object(c.a)(n)),n.toggleHistoryPane=n.toggleHistoryPane.bind(Object(c.a)(n)),n.changeSearchTerm=n.changeSearchTerm.bind(Object(c.a)(n)),n.changeDbIndex=n.changeDbIndex.bind(Object(c.a)(n)),n.changeColumns=n.changeColumns.bind(Object(c.a)(n)),n.changeDbSchemaDefinitions=n.changeDbSchemaDefinitions.bind(Object(c.a)(n)),n.changeDbPkInfo=n.changeDbPkInfo.bind(Object(c.a)(n)),n.changeVisibleColumns=n.changeVisibleColumns.bind(Object(c.a)(n)),n.addToHistory=n.addToHistory.bind(Object(c.a)(n)),n.closeHistoryPane=n.closeHistoryPane.bind(Object(c.a)(n)),n.changeTable=n.changeTable.bind(Object(c.a)(n)),n.changeRules=n.changeRules.bind(Object(c.a)(n)),n}return Object(o.a)(a,[{key:"parseURL",value:function(){var e,t=""+window.location.href,a=/\/db\/\d\//g.exec(t);e=a?parseInt(a[0].replace(/\/db\//g,"").replace(/\//g,""),10):0;var n=[];la.getValueFromConfig("databases").map((function(e,t){return n[t]=e.title||"Untitled database"})),n[e]||(e=0);var i,r=/\/table\/\w+\/?/g.exec(t);i=r?r[0].replace(/\/table\//g,"").replace(/\//g,""):null;var s,l=/query=.*/g.exec(t);l?(s=l[0].replace("query=",""),(s=decodeURIComponent(s))&&(s=JSON.parse(s))):s=null;var o,c=/rowLimit=\d+/g.exec(t);o=c?parseInt(c[0].replace(/rowLimit=/g,""),10):null;var u=/exactCount=True|exactCount=False/g.exec(t);return{db:e,table:i,urlRules:s,rowLimit:o,exactCount:!!u&&"True"===u[0].replace(/exactCount=/g,"")}}},{key:"toggleLeftPane",value:function(){this.setState({leftPaneVisibility:!this.state.leftPaneVisibility})}},{key:"toggleHistoryPane",value:function(){this.setState({historyPaneVisibility:!this.state.historyPaneVisibility})}},{key:"closeHistoryPane",value:function(){this.setState({historyPaneVisibility:!1})}},{key:"changeDbIndex",value:function(e){var t=this;this.setState({dbIndex:e,isLoggedIn:!1,token:null,userName:"Unknown username"}),oa&&(oa.setDb(e),oa.getUserDetails().then((function(e){e.isLoggedIn?t.setState({token:e.jwtToken,userName:e.name,isLoggedIn:!0}):t.setState({isLoggedIn:!1,token:null,userName:"Unknown username"})})))}},{key:"changeSearchTerm",value:function(e){this.setState({searchTerm:e})}},{key:"changeTable",value:function(e){this.setState({table:e})}},{key:"changeRules",value:function(e){this.setState({rulesFromHistoryPane:e})}},{key:"changeDbSchemaDefinitions",value:function(e){this.setState({dbSchemaDefinitions:e})}},{key:"changeDbPkInfo",value:function(e){this.setState({dbPkInfo:e})}},{key:"changeColumns",value:function(e){this.setState({columns:e})}},{key:"addToHistory",value:function(e,t){this.setState({newHistoryItem:[e.replace(/\?limit=\d*/g,""),t]})}},{key:"changeVisibleColumns",value:function(e){this.setState({visibleColumns:e})}},{key:"setUserEmailPassword",value:function(e,t){var a=this;oa&&(oa.setCredentials(e,t),oa.getUserDetails().then((function(e){e.isLoggedIn?a.setState({token:e.jwtToken,userName:e.name,isLoggedIn:!0}):a.setState({isLoggedIn:!1,token:null,userName:"Unknown username"}),a.state.rulesFromURL&&"private"===la.getDbConfig(a.state.dbIndex,"publicDbAcessType")&&e.isLoggedIn&&a.changeRules(a.state.rulesFromURL)})))}},{key:"componentDidMount",value:function(){var e=this;this.state.rulesFromURL&&"private"!==la.getDbConfig(this.state.dbIndex,"publicDbAcessType")&&this.changeRules(this.state.rulesFromURL),oa&&oa.getUserDetails().then((function(t){t.isLoggedIn&&e.setState({token:t.jwtToken,userName:t.name,isLoggedIn:!0})}))}},{key:"render",value:function(){var e=la.getDbConfig(this.state.dbIndex,"publicDbAcessType")||"read";return i.a.createElement(i.a.Fragment,null,i.a.createElement(ze,Object.assign({},this.state,{changeSearchTerm:this.changeSearchTerm,toggleLeftPane:this.toggleLeftPane,toggleHistoryPane:this.toggleHistoryPane,setUserEmailPassword:this.setUserEmailPassword,publicDBStatus:e,handleLogoutClick:this.handleLogoutClick})),i.a.createElement("div",{className:"bodyDiv"},i.a.createElement(pe,Object.assign({},this.state,{changeSearchTerm:this.changeSearchTerm,changeDbIndex:this.changeDbIndex,changeTable:this.changeTable,changeColumns:this.changeColumns,changeDbSchemaDefinitions:this.changeDbSchemaDefinitions,changeDbPkInfo:this.changeDbPkInfo,changeVisibleColumns:this.changeVisibleColumns,publicDBStatus:e})),i.a.createElement(ra,Object.assign({},this.state,{changeRules:this.changeRules,addToHistory:this.addToHistory,publicDBStatus:e})),i.a.createElement(V,Object.assign({},this.state,{closeHistoryPane:this.closeHistoryPane,changeTable:this.changeTable,changeRules:this.changeRules,publicDBStatus:e}))))}}]),a}(i.a.Component),ua=document.getElementById("root");s.a.render(i.a.createElement(ca,null),ua);var ha=document.getElementById("root"),da={};window.setState=function(e){da=Object.assign({},da,e),s.a.render(i.a.createElement(ca,da),ha)};var ma={urlLocation:location.pathname.replace(/^\/?|\/$/g,"")};window.setState(ma)},42:function(e,t,a){"use strict";function n(e){try{var t,n;return t=a(213),void 0!==(n=JSON.parse(JSON.stringify(t)))[e]?n[e]:null}catch(i){return null}}function i(e,t){if(null===e||null===t)return null;try{var a=n("databases");return void 0!==a[e][t]?a[e][t]:null}catch(i){return null}}function r(e,t,a){if(null===e||null===t||null===a)return null;try{var n=i(e,"tableRules");return void 0!==n[t][a]?n[t][a]:null}catch(r){return null}}function s(e,t,a){try{if(i(e,"columnRulesGlobal")){var n=i(e,"columnRulesGlobal")[t];return n&&void 0!==n[a]?n[a]:null}}catch(r){return null}return null}function l(e,t,a,n){if(null===e||null===t||null===a||null===n)return s(e,a,n);try{var i=r(e,t,"columnRules");return null!==i[a][n]&&void 0!==i[a][n]?i[a][n]:s(e,a,n)}catch(l){return s(e,a,n)}}function o(e,t,a){if(null!==e&&null!==t&&null!==a)try{var n=r(e,t,"defaultViewColumns");return null===n||void 0===n?null:y(a,n)}catch(i){return null}return null}function c(){return{condition:"AND",rules:[{empty:!0}]}}function u(){return{operators:{regex:"matches regex"}}}function h(){return[{type:"equal"},{type:"not_equal"},{type:"in"},{type:"not_in"},{type:"less"},{type:"less_or_equal"},{type:"greater"},{type:"greater_or_equal"},{type:"between"},{type:"not_between"},{type:"begins_with"},{type:"not_begins_with"},{type:"contains"},{type:"not_contains"},{type:"ends_with"},{type:"not_ends_with"},{type:"is_empty"},{type:"is_not_empty"},{type:"is_null"},{type:"is_not_null"},{type:"regex",nb_inputs:1,multiple:!1,apply_to:["string"]}]}function d(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=["equal","not_equal","greater","less","greater_or_equal","less_or_equal","is_not_null","is_null","in","contains"],s=["equal","not_equal","greater","less","greater_or_equal","less_or_equal","is_not_null","is_null","in"],o=["equal","not_equal","is_not_null","is_null","in","contains"],c=["equal","not_equal","is_not_null","is_null","in"];if(!0===i(e,"regexSupport")&&(r.push("regex"),o.push("regex")),!a||a.length<=0)return[{id:"error",label:"ERROR: select a view...",type:"string"}];for(var u=[],h=0;h<a.length;h++){var d=l(e,t,a[h],"type");if(null===d&&null!==n&&null!==n[t].properties[a[h]]&&void 0!==n[t].properties[a[h]]){var m=n[t].properties[a[h]].type;"number"!==m&&"numeric"!==m||(m="double"),d=m}var p=l(e,t,a[h],"operators");null===p&&null!==d&&(p="integer"===d||"double"===d?s:"string"===d?o:"boolean"===d?c:r),u.push({id:a[h],label:l(e,t,a[h],"rename"),type:d,input:"integer"===d||"double"===d?"text":l(e,t,a[h],"input"),value_separator:",",values:l(e,t,a[h],"values"),validation:l(e,t,a[h],"validation"),default_value:l(e,t,a[h],"defaultValue"),operators:p})}return u}function m(e){for(var t=[["equal","eq"],["not_equal","neq"],["greater","gt"],["less","lt"],["greater_or_equal","gte"],["less_or_equal","lte"],["is_not_null","not.is"],["in","in"],["contains","ilike"],["regex","rx"],["is_null","is"]],a=0;a<t.length;a++)if(t[a][0]===e)return t[a][1];return"eq"}function p(e){for(var t=[["eq","equal"],["neq","not_equal"],["gt","greater"],["lt","less"],["gte","greater_or_equal"],["lte","less_or_equal"],["not.s","is_not_null"],["in","in"],["ilike","contains"],["rx","regex"],["is","is_null"]],a=0;a<t.length;a++)if(t[a][0]===e)return t[a][1];return"equal"}function b(e){for(var t=[["equal","="],["not_equal","!="],["greater",">"],["less","<"],["greater_or_equal",">="],["less_or_equal","<="],["is_not_null","is not NULL"],["in","in"],["contains","CONTAINS"],["regex","matches"],["is_null","is NULL"]],a=0;a<t.length;a++)if(t[a][0]===e)return t[a][1];return e}function g(e){try{JSON.parse(e)}catch(t){return!1}return!0}function f(e,t){for(var a=0;a<t.length;a++)if(e.length===t[a].length)for(var n=0;n<e.length&&JSON.stringify(e[n])===JSON.stringify(t[a][n]);n++)if(n===e.length-1)return a;return-1}function y(e,t){return!(!t||!e)&&(e.constructor===Array?f(e,t)>-1:t.indexOf(e)>-1)}function v(e,t){return t&&e?e.constructor===Array?f(e,t):t.indexOf(e):-1}function C(e,t,a){for(var n=e[t],i=(a-t)/Math.abs(a-t),r=t;r!==a;r+=i)e[r]=e[r+i];return e[a]=n,e}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://www.google.ca";window.open(e,"_blank")}function w(e){var t=[];for(var a in e){var n=e[a];for(var i in n){var r=i;t.push(r)}}return t}function E(e){for(var t={},a=0;a<e.length;a++)t[e[a]]=!0;var n=[];for(var i in t)n.push(i);return n}a.r(t),a.d(t,"getValueFromConfig",(function(){return n})),a.d(t,"getDbConfig",(function(){return i})),a.d(t,"getTableConfig",(function(){return r})),a.d(t,"getColumnConfigGlobal",(function(){return s})),a.d(t,"getColumnConfig",(function(){return l})),a.d(t,"isColumnInDefaultView",(function(){return o})),a.d(t,"getQBRules",(function(){return c})),a.d(t,"getQBLang",(function(){return u})),a.d(t,"getQBOperators",(function(){return h})),a.d(t,"getQBFilters",(function(){return d})),a.d(t,"translateOperatorToPostgrest",(function(){return m})),a.d(t,"translateOperatorTojQB",(function(){return p})),a.d(t,"translateOperatorToHuman",(function(){return b})),a.d(t,"isJsonString",(function(){return g})),a.d(t,"searchForArrayInArray",(function(){return f})),a.d(t,"inArray",(function(){return y})),a.d(t,"elementPositionInArray",(function(){return v})),a.d(t,"moveArrayElementFromTo",(function(){return C})),a.d(t,"visitPage",(function(){return k})),a.d(t,"getKeysFromJSON",(function(){return w})),a.d(t,"arrNoDup",(function(){return E}))}},[[187,1,2]]]);
//# sourceMappingURL=main.36347f96.chunk.js.map